<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>flavio.statistics.fits API documentation</title>
    <meta name="description" content="A fit is a collection of observables and parameters that can be used to
perform statistical analyses..." />

  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Noto+Sans:400' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/public/plugins/katex/katex.min.css">
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

    .katex {
      font-size:1em;
    }
    .katex .mathit, .katex .mathrm {
      font-family: 'Noto Sans';
    }
  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
  }
  body {
    background: #fff;
    font-family: "Noto Sans", "Helvetica Neue", Helvetica, sans;
    font-weight: 400;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  }

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; }

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;

      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/

  </style>

  <style type="text/css">
  .codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #BC7A00 } /* Comment.Preproc */
.codehilite .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #408080; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #408080; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #999999; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #A0A000 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sa { color: #BA2121 } /* Literal.String.Affix */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .dl { color: #BA2121 } /* Literal.String.Delimiter */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #BB6688 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #0000FF } /* Name.Function.Magic */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .vm { color: #19177C } /* Name.Variable.Magic */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>

  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
    <script src="/public/plugins/katex/katex.min.js"></script>
    <script src="/public/plugins/katex/auto-render.min.js"></script>
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">


    <li class="set"><h3><a href="#header-classes">Classes</a></h3>
      <ul>
        <li class="mono">
        <span class="class_name"><a href="#flavio.statistics.fits.BayesianFit">BayesianFit</a></span>
        
          
  <ul>
    <li class="mono"><a href="#flavio.statistics.fits.BayesianFit.__init__">__init__</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.BayesianFit.array_to_dict">array_to_dict</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.BayesianFit.dict_to_array">dict_to_array</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.BayesianFit.get_par_dict">get_par_dict</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.BayesianFit.get_predictions">get_predictions</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.BayesianFit.get_predictions_array">get_predictions_array</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.BayesianFit.get_wc_obj">get_wc_obj</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.BayesianFit.log_likelihood_exp">log_likelihood_exp</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.BayesianFit.log_prior_nuisance_parameters">log_prior_nuisance_parameters</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.BayesianFit.log_prior_parameters">log_prior_parameters</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.BayesianFit.log_prior_wilson_coeffs">log_prior_wilson_coeffs</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.BayesianFit.log_target">log_target</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.BayesianFit.set_description">set_description</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.BayesianFit.clear_all">clear_all</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.BayesianFit.del_instance">del_instance</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.BayesianFit.get_instance">get_instance</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#flavio.statistics.fits.FastFit">FastFit</a></span>
        
          
  <ul>
    <li class="mono"><a href="#flavio.statistics.fits.FastFit.__init__">__init__</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FastFit.array_to_dict">array_to_dict</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FastFit.best_fit">best_fit</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FastFit.dict_to_array">dict_to_array</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FastFit.dict_to_shortarray">dict_to_shortarray</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FastFit.get_exp_central_covariance">get_exp_central_covariance</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FastFit.get_par_dict">get_par_dict</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FastFit.get_predictions">get_predictions</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FastFit.get_predictions_array">get_predictions_array</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FastFit.get_sm_covariance">get_sm_covariance</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FastFit.get_wc_obj">get_wc_obj</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FastFit.load_exp_central_covariance">load_exp_central_covariance</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FastFit.load_exp_central_covariance_dict">load_exp_central_covariance_dict</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FastFit.load_sm_covariance">load_sm_covariance</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FastFit.load_sm_covariance_dict">load_sm_covariance_dict</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FastFit.log_likelihood">log_likelihood</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FastFit.log_likelihood_exp">log_likelihood_exp</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FastFit.log_prior_nuisance_parameters">log_prior_nuisance_parameters</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FastFit.log_prior_parameters">log_prior_parameters</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FastFit.log_prior_wilson_coeffs">log_prior_wilson_coeffs</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FastFit.make_measurement">make_measurement</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FastFit.save_exp_central_covariance">save_exp_central_covariance</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FastFit.save_sm_covariance">save_sm_covariance</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FastFit.set_description">set_description</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FastFit.shortarray_to_array">shortarray_to_array</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FastFit.shortarray_to_dict">shortarray_to_dict</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FastFit.clear_all">clear_all</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FastFit.del_instance">del_instance</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FastFit.get_instance">get_instance</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#flavio.statistics.fits.Fit">Fit</a></span>
        
          
  <ul>
    <li class="mono"><a href="#flavio.statistics.fits.Fit.__init__">__init__</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.Fit.array_to_dict">array_to_dict</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.Fit.dict_to_array">dict_to_array</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.Fit.get_par_dict">get_par_dict</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.Fit.get_predictions">get_predictions</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.Fit.get_predictions_array">get_predictions_array</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.Fit.get_wc_obj">get_wc_obj</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.Fit.log_likelihood_exp">log_likelihood_exp</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.Fit.log_prior_nuisance_parameters">log_prior_nuisance_parameters</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.Fit.log_prior_parameters">log_prior_parameters</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.Fit.log_prior_wilson_coeffs">log_prior_wilson_coeffs</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.Fit.set_description">set_description</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.Fit.clear_all">clear_all</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.Fit.del_instance">del_instance</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.Fit.get_instance">get_instance</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#flavio.statistics.fits.FrequentistFit">FrequentistFit</a></span>
        
          
  <ul>
    <li class="mono"><a href="#flavio.statistics.fits.FrequentistFit.__init__">__init__</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FrequentistFit.array_to_dict">array_to_dict</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FrequentistFit.dict_to_array">dict_to_array</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FrequentistFit.get_par_dict">get_par_dict</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FrequentistFit.get_predictions">get_predictions</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FrequentistFit.get_predictions_array">get_predictions_array</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FrequentistFit.get_wc_obj">get_wc_obj</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FrequentistFit.log_likelihood">log_likelihood</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FrequentistFit.log_likelihood_exp">log_likelihood_exp</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FrequentistFit.log_prior_nuisance_parameters">log_prior_nuisance_parameters</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FrequentistFit.log_prior_parameters">log_prior_parameters</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FrequentistFit.log_prior_wilson_coeffs">log_prior_wilson_coeffs</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FrequentistFit.set_description">set_description</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FrequentistFit.clear_all">clear_all</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FrequentistFit.del_instance">del_instance</a></li>
    <li class="mono"><a href="#flavio.statistics.fits.FrequentistFit.get_instance">get_instance</a></li>
  </ul>

        </li>
      </ul>
    </li>

    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">flavio.statistics.fits</span> module</h1>
  <p>A fit is a collection of observables and parameters that can be used to
perform statistical analyses within a particular statistical framework.</p>
<p>Fits are instances of descendants of the <code>Fit</code> class (which is not meant
to be used directly).</p>
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits" class="source">
    <div class="codehilite"><pre><span></span><span class="sd">&quot;&quot;&quot;A fit is a collection of observables and parameters that can be used to</span>
<span class="sd">perform statistical analyses within a particular statistical framework.</span>

<span class="sd">Fits are instances of descendants of the `Fit` class (which is not meant</span>
<span class="sd">to be used directly).&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">flavio</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">flavio.statistics.probability</span> <span class="kn">import</span> <span class="n">NormalDistribution</span><span class="p">,</span> <span class="n">MultivariateNormalDistribution</span>
<span class="kn">from</span> <span class="nn">flavio.math.optimize</span> <span class="kn">import</span> <span class="n">minimize_robust</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span><span class="p">,</span> <span class="n">OrderedDict</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
<span class="kn">import</span> <span class="nn">scipy.optimize</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">import</span> <span class="nn">yaml</span>


<span class="k">class</span> <span class="nc">Fit</span><span class="p">(</span><span class="n">flavio</span><span class="o">.</span><span class="n">NamedInstanceClass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for fits. Not meant to be used directly.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">name</span><span class="p">,</span>
                 <span class="n">par_obj</span><span class="o">=</span><span class="n">flavio</span><span class="o">.</span><span class="n">default_parameters</span><span class="p">,</span>
                 <span class="n">fit_parameters</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">nuisance_parameters</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">observables</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">fit_wc_names</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">fit_wc_function</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">fit_wc_priors</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">input_scale</span><span class="o">=</span><span class="mf">160.</span><span class="p">,</span>
                 <span class="n">exclude_measurements</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">include_measurements</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">fit_wc_eft</span><span class="o">=</span><span class="s1">&#39;WET&#39;</span><span class="p">,</span>
                 <span class="n">fit_wc_basis</span><span class="o">=</span><span class="s1">&#39;flavio&#39;</span><span class="p">,</span>
                <span class="p">):</span>
        <span class="k">if</span> <span class="n">fit_parameters</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span> <span class="o">=</span> <span class="n">fit_parameters</span>
        <span class="k">if</span> <span class="n">nuisance_parameters</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="n">nuisance_parameters</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span> <span class="o">=</span> <span class="n">par_obj</span><span class="o">.</span><span class="n">all_parameters</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span> <span class="o">=</span> <span class="n">nuisance_parameters</span>
        <span class="k">if</span> <span class="n">observables</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;observables&#39; is empty: you must specify at least one fit observable&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fit_wc_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;The &#39;fit_wc_names&#39; argument is no longer necessary &quot;</span>
            <span class="s2">&quot;as of flavio v0.19 and might be removed in the future.&quot;</span><span class="p">,</span>
            <span class="ne">FutureWarning</span><span class="p">)</span>
        <span class="c1"># some checks to make sure the input is sane</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">:</span>
            <span class="c1"># check that nuisance parameters are constrained</span>
            <span class="k">assert</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">par_obj</span><span class="o">.</span><span class="n">_parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="s2">&quot;Parameter &quot;</span> <span class="o">+</span> <span class="n">p</span> <span class="o">+</span> <span class="s2">&quot; not found in Constraints&quot;</span>
        <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">observables</span><span class="p">:</span>
            <span class="c1"># check that observables exist</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="p">[</span><span class="n">obs</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unexpected form of observable: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obs</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Observable &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; not found!&quot;</span><span class="p">)</span>
        <span class="n">_obs_measured</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">exclude_measurements</span> <span class="ow">and</span> <span class="n">include_measurements</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The options exclude_measurements and include_measurements must not be specified simultaneously&quot;</span><span class="p">)</span>
        <span class="c1"># check that no parameter appears as fit *and* nuisance parameter</span>
        <span class="n">intersect</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">intersect</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(),</span> <span class="s2">&quot;Parameters appearing as fit_parameters and nuisance_parameters: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">intersect</span><span class="p">)</span>
        <span class="c1"># check that the Wilson coefficient function works</span>
        <span class="k">if</span> <span class="n">fit_wc_function</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="c1"># if list of WC names not empty</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">fit_wc_function</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="n">fit_wc_function</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">fit_wc_name</span><span class="p">:</span> <span class="mf">1e-6</span> <span class="k">for</span> <span class="n">fit_wc_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">})</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Error in calling the Wilson coefficient function&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>
        <span class="c1"># now that everything seems fine, we can call the init of the parent class</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span> <span class="o">=</span> <span class="n">par_obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters_central</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_central_all</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exclude_measurements</span> <span class="o">=</span> <span class="n">exclude_measurements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">include_measurements</span> <span class="o">=</span> <span class="n">include_measurements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_function</span> <span class="o">=</span> <span class="n">fit_wc_function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_priors</span> <span class="o">=</span> <span class="n">fit_wc_priors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observables</span> <span class="o">=</span> <span class="n">observables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_scale</span> <span class="o">=</span> <span class="n">input_scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_warn_meas_corr</span>

        <span class="c1"># check that observables are constrained</span>
        <span class="k">for</span> <span class="n">m_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_measurements</span><span class="p">:</span>
            <span class="n">m_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">Measurement</span><span class="p">[</span><span class="n">m_name</span><span class="p">]</span>
            <span class="n">_obs_measured</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span><span class="p">)</span>
        <span class="n">missing_obs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">observables</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">_obs_measured</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">observables</span><span class="p">))</span>
        <span class="k">assert</span> <span class="n">missing_obs</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(),</span> <span class="s2">&quot;No measurement found for the observables: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">missing_obs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eft</span> <span class="o">=</span> <span class="n">fit_wc_eft</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="n">fit_wc_basis</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_central_fit_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a numpy array with the central values of all fit parameters.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters_central</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_random_fit_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a numpy array with random values for all fit parameters.&quot;&quot;&quot;</span>
        <span class="n">all_random</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_random_all</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">all_random</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_random_wilson_coeffs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a numpy array with random values for all Wilson coefficients.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_priors</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">all_random</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_priors</span><span class="o">.</span><span class="n">get_random_all</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">all_random</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_central_nuisance_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a numpy array with the central values of all nuisance parameters.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters_central</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_random_nuisance_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a numpy array with random values for all nuisance parameters.&quot;&quot;&quot;</span>
        <span class="n">all_random</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_random_all</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">all_random</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_measurements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of all the measurements currently defined that</span>
<span class="sd">        constrain any of the fit observables.&quot;&quot;&quot;</span>
        <span class="n">all_measurements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">m_name</span><span class="p">,</span> <span class="n">m_obj</span> <span class="ow">in</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Measurement</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">m_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Pseudo-measurement&#39;</span><span class="p">:</span>
                <span class="c1"># skip pseudo measurements generated by FastFit instances</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span><span class="p">)</span><span class="o">.</span><span class="n">isdisjoint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">):</span>
                <span class="c1"># if set of all observables constrained by measurement is disjoint</span>
                <span class="c1"># with fit observables, do nothing</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># else, add measurement name to output list</span>
                <span class="n">all_measurements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclude_measurements</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_measurements</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">all_measurements</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclude_measurements</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">all_measurements</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exclude_measurements</span><span class="p">))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_measurements</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">all_measurements</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">include_measurements</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_warn_meas_corr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Warn the user if the fit contains multiple correlated measurements of</span>
<span class="sd">        an observable that is not included in the fit parameters, as this will</span>
<span class="sd">        lead to inconsistent results.&quot;&quot;&quot;</span>
        <span class="n">corr_with</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># iterate over all measurements constraining at least one fit obs.</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_measurements</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Measurement</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="c1"># iterate over all fit obs. constrained by this measurement</span>
            <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">all_parameters</span><span class="p">):</span>
                <span class="c1"># the constraint on this fit obs.</span>
                <span class="n">constraint</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">_parameters</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="c1"># find all the other obs. constrained by this constraint</span>
                <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">_constraints</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">constraint</span><span class="p">:</span>
                        <span class="n">par</span> <span class="o">=</span> <span class="n">p</span>
                        <span class="k">break</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">par</span><span class="p">:</span>
                    <span class="c1"># if the other obs. are not fit obs., append them to the list</span>
                    <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">corr_with</span><span class="p">:</span>
                            <span class="n">corr_with</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">obs</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">corr_with</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="c1"># replace list by a Counter</span>
        <span class="n">corr_with</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">Counter</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">corr_with</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="p">}</span>
        <span class="c1"># warn for all counts &gt; 1</span>
        <span class="k">for</span> <span class="n">obs1</span><span class="p">,</span> <span class="n">counter</span> <span class="ow">in</span> <span class="n">corr_with</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">obs2</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">counter</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">((</span><span class="s2">&quot;{} of the measurements in the fit &#39;{}&#39; &quot;</span>
                                   <span class="s2">&quot;constrain both &#39;{}&#39; and &#39;{}&#39;, but only the &quot;</span>
                                   <span class="s2">&quot;latter is included among the fit &quot;</span>
                                   <span class="s2">&quot;observables. This can lead to inconsistent &quot;</span>
                                   <span class="s2">&quot;results as the former is profiled over.&quot;</span>
                                   <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">obs1</span><span class="p">,</span> <span class="n">obs2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">corr_with</span>


    <span class="k">def</span> <span class="nf">array_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a 1D numpy array of floats to a dictionary of fit parameters,</span>
<span class="sd">        nuisance parameters, and Wilson coefficients.&quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">n_fit_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span>
        <span class="n">n_nui_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span>
        <span class="n">n_wc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">p</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span> <span class="p">}</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;nuisance_parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">p</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">n_fit_p</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span> <span class="p">}</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_wc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">p</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">n_fit_p</span> <span class="o">+</span> <span class="n">n_nui_p</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span> <span class="p">}</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="k">def</span> <span class="nf">dict_to_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a dictionary of fit parameters,</span>
<span class="sd">        nuisance parameters, and Wilson coefficients to a 1D numpy array of</span>
<span class="sd">        floats.&quot;&quot;&quot;</span>
        <span class="n">n_fit_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span>
        <span class="n">n_nui_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span>
        <span class="n">n_wc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_fit_p</span> <span class="o">+</span> <span class="n">n_nui_p</span> <span class="o">+</span> <span class="n">n_wc</span><span class="p">)</span>
        <span class="n">arr</span><span class="p">[:</span><span class="n">n_fit_p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_parameters&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">]</span>
        <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="p">:</span><span class="n">n_fit_p</span><span class="o">+</span><span class="n">n_nui_p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;nuisance_parameters&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">]</span>
        <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="o">+</span><span class="n">n_nui_p</span><span class="p">:]</span>   <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_wc&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">arr</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_random</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get an array with random values for all the fit and nuisance</span>
<span class="sd">        parameters and Wilson coefficients.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_random</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_random</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">par</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nuisance</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">wc</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get an array with random values for all the fit and nuisance</span>
<span class="sd">        parameters and Wilson coefficients.</span>

<span class="sd">        If par is False, fit parameters are set to their central values.</span>
<span class="sd">        If nuisance is False, nuisance parameters are set to their central values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="p">)</span>
        <span class="n">n_fit_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span>
        <span class="n">n_nui_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">par</span><span class="p">:</span>
            <span class="n">arr</span><span class="p">[:</span><span class="n">n_fit_p</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_random_fit_parameters</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">arr</span><span class="p">[:</span><span class="n">n_fit_p</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_central_fit_parameters</span>
        <span class="k">if</span> <span class="n">nuisance</span><span class="p">:</span>
            <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="p">:</span><span class="n">n_fit_p</span><span class="o">+</span><span class="n">n_nui_p</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_random_nuisance_parameters</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="p">:</span><span class="n">n_fit_p</span><span class="o">+</span><span class="n">n_nui_p</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_central_nuisance_parameters</span>
        <span class="k">if</span> <span class="n">wc</span><span class="p">:</span>
            <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="o">+</span><span class="n">n_nui_p</span><span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_random_wilson_coeffs</span>
        <span class="k">return</span> <span class="n">arr</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_random_wilson_coeffs_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a numpy array with random values for all Wilson coefficients</span>
<span class="sd">        sampling the start_wc_priors distribution.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_function</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># no Wilson coefficients present</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_wc_priors</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_priors</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Starting values can only be generated if&quot;</span>
                        <span class="s2">&quot; either fit_wc_priors or start_wc_priors is defined&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_random_wilson_coeffs</span>
        <span class="n">all_random</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_wc_priors</span><span class="o">.</span><span class="n">get_random_all</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">all_random</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_random_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get an array with random values for all the fit and nuisance</span>
<span class="sd">        parameters with Wilson coefficients set to their SM values&quot;&quot;&quot;</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="p">)</span>
        <span class="n">n_fit_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span>
        <span class="n">n_nui_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span>
        <span class="n">arr</span><span class="p">[:</span><span class="n">n_fit_p</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_random_fit_parameters</span>
        <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="p">:</span><span class="n">n_fit_p</span><span class="o">+</span><span class="n">n_nui_p</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_random_nuisance_parameters</span>
        <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="o">+</span><span class="n">n_nui_p</span><span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_random_wilson_coeffs_start</span>
        <span class="k">return</span> <span class="n">arr</span>

    <span class="k">def</span> <span class="nf">get_par_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">par</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nuisance</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a dictionary of fit and nuisance parameters from an input array</span>

<span class="sd">        If par is False, fit parameters are set to their central values.</span>
<span class="sd">        If nuisance is False, nuisance parameters are set to their central values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array_to_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">par_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters_central</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">par</span><span class="p">:</span>
            <span class="n">par_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_parameters&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">nuisance</span><span class="p">:</span>
            <span class="n">par_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;nuisance_parameters&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">par_dict</span>

    <span class="k">def</span> <span class="nf">get_wc_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">wc_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">WilsonCoefficients</span><span class="p">()</span>
        <span class="c1"># if there are no WCs to be fitted, return the SM WCs</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">wc_obj</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array_to_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">wc_obj</span><span class="o">.</span><span class="n">set_initial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_function</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_wc&#39;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_scale</span><span class="p">,</span>
                           <span class="n">eft</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eft</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">basis</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wc_obj</span>

    <span class="k">def</span> <span class="nf">log_prior_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the prior probability for all fit and nuisance parameters</span>
<span class="sd">        given an input array&quot;&quot;&quot;</span>
        <span class="n">par_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_par_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">exclude_parameters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">par_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">))</span>
        <span class="n">prob_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">exclude_parameters</span><span class="o">=</span><span class="n">exclude_parameters</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prob_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>

    <span class="k">def</span> <span class="nf">log_prior_wilson_coeffs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the prior probability for all Wilson coefficients</span>
<span class="sd">        given an input array&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_priors</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="n">wc_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array_to_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="s1">&#39;fit_wc&#39;</span><span class="p">]</span>
        <span class="n">prob_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_priors</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">wc_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prob_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>

    <span class="k">def</span> <span class="nf">get_predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">par</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nuisance</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">wc</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a dictionary with predictions for all observables given an input</span>
<span class="sd">        array.</span>

<span class="sd">        If par is False, fit parameters are set to their central values.</span>
<span class="sd">        If nuisance is False, nuisance parameters are set to their central values.</span>
<span class="sd">        If wc is False, Wilson coefficients are set to their SM values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">par_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_par_dict</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">par</span><span class="o">=</span><span class="n">par</span><span class="p">,</span> <span class="n">nuisance</span><span class="o">=</span><span class="n">nuisance</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wc</span><span class="p">:</span>
            <span class="n">wc_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wc_obj</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wc_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">physics</span><span class="o">.</span><span class="n">eft</span><span class="o">.</span><span class="n">_wc_sm</span>
        <span class="n">all_predictions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">observable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">observable</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">obs_name</span> <span class="o">=</span> <span class="n">observable</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">_inst</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="p">[</span><span class="n">obs_name</span><span class="p">]</span>
                <span class="n">all_predictions</span><span class="p">[</span><span class="n">observable</span><span class="p">]</span> <span class="o">=</span> <span class="n">_inst</span><span class="o">.</span><span class="n">prediction_par</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="o">*</span><span class="n">observable</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_inst</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="p">[</span><span class="n">observable</span><span class="p">]</span>
                <span class="n">all_predictions</span><span class="p">[</span><span class="n">observable</span><span class="p">]</span> <span class="o">=</span> <span class="n">_inst</span><span class="o">.</span><span class="n">prediction_par</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">all_predictions</span>

    <span class="k">def</span> <span class="nf">get_predictions_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_predictions</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pred</span><span class="p">[</span><span class="n">obs</span><span class="p">]</span> <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">log_prior_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the prior probability (or frequentist likelihood) for all</span>
<span class="sd">        fit and (!) nuisance parameters given an input array&quot;&quot;&quot;</span>
        <span class="n">par_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_par_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">exclude_parameters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">par_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">))</span>
        <span class="n">prob_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">exclude_parameters</span><span class="o">=</span><span class="n">exclude_parameters</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prob_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>

    <span class="k">def</span> <span class="nf">log_prior_nuisance_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the prior probability (or frequentist likelihood) for all</span>
<span class="sd">        nuisance parameters given an input array&quot;&quot;&quot;</span>
        <span class="n">par_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_par_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">exclude_parameters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">par_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">))</span>
        <span class="n">prob_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">exclude_parameters</span><span class="o">=</span><span class="n">exclude_parameters</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prob_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>

    <span class="k">def</span> <span class="nf">log_likelihood_exp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the logarithm of the likelihood function (not including the</span>
<span class="sd">        prior)&quot;&quot;&quot;</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_predictions</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">for</span> <span class="n">measurement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_measurements</span><span class="p">:</span>
            <span class="n">m_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">Measurement</span><span class="p">[</span><span class="n">measurement</span><span class="p">]</span>
            <span class="n">m_obs</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span>
            <span class="n">exclude_observables</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">m_obs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span>
            <span class="n">prob_dict</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">exclude_parameters</span><span class="o">=</span><span class="n">exclude_observables</span><span class="p">)</span>
            <span class="n">ll</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">prob_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">ll</span>


<span class="k">class</span> <span class="nc">BayesianFit</span><span class="p">(</span><span class="n">Fit</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Bayesian fit class. Instances of this class can then be fed to samplers.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    - `name`: a descriptive string name</span>
<span class="sd">    - `par_obj`: optional; an instance of `ParameterConstraints`.</span>
<span class="sd">      Defaults to `flavio.default_parameters`</span>
<span class="sd">    - `fit_parameters`: a list of string names of parameters of interest. The existing</span>
<span class="sd">      constraints on the parameter will be taken as prior.</span>
<span class="sd">    - `nuisance_parameters`: a list of string names of nuisance parameters. The existing</span>
<span class="sd">      constraints on the parameter will be taken as prior. Alternatively, it</span>
<span class="sd">      can also be set to &#39;all&#39;, in which case all the parameters constrainted</span>
<span class="sd">      by `par_obj` will be treated as nuisance parameters. (Note that this makes</span>
<span class="sd">      sense for `FastFit`, but not for a MCMC since the number of nuisance</span>
<span class="sd">      parameters will be huge.)</span>
<span class="sd">    - `observables`: a list of observable names to be included in the fit</span>
<span class="sd">    - `exclude_measurements`: optional; a list of measurement names *not* to be included in</span>
<span class="sd">    the fit. By default, all existing measurements are included.</span>
<span class="sd">    - `include_measurements`: optional; a list of measurement names to be included in</span>
<span class="sd">    the fit. By default, all existing measurements are included.</span>
<span class="sd">    - `fit_wc_names`: optional; a list of string names of arguments of the Wilson</span>
<span class="sd">      coefficient function below</span>
<span class="sd">    - `fit_wc_function`: optional; a function that</span>
<span class="sd">      returns a dictionary that can be fed to the `set_initial`</span>
<span class="sd">      method of the Wilson coefficient class. Example: fit the real and imaginary</span>
<span class="sd">      parts of $C_{10}$ in $b\to s\mu^+\mu^-$.</span>
<span class="sd">    ```</span>
<span class="sd">    def fit_wc_function(Re_C10, Im_C10):</span>
<span class="sd">        return {&#39;C10_bsmmumu&#39;: Re_C10 + 1j*Im_C10}</span>
<span class="sd">    ```</span>
<span class="sd">    - `input_scale`: input scale for the Wilson coeffficients. Defaults to 160.</span>
<span class="sd">    - `fit_wc_priors`: optional; an instance of WilsonCoefficientPriors</span>
<span class="sd">      containing prior constraints on the Wilson coefficients</span>
<span class="sd">    - `start_wc_priors`: optional; an instance of WilsonCoefficientPriors</span>
<span class="sd">      that will not be used during a scan, but only for finding starting values</span>
<span class="sd">      for Wilson coefficients in MCMC analyses. This can be useful if no</span>
<span class="sd">      actual priors are used or if they are too loose to provide good starting</span>
<span class="sd">      points.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">start_wc_priors</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_wc_priors</span> <span class="o">=</span> <span class="n">start_wc_priors</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">:</span>
            <span class="c1"># check that fit parameters are constrained</span>
            <span class="k">assert</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">_parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="s2">&quot;Parameter &quot;</span> <span class="o">+</span> <span class="n">p</span> <span class="o">+</span> <span class="s2">&quot; not found in Constraints&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_random</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get an array with random values for all the fit and nuisance</span>
<span class="sd">        parameters&quot;&quot;&quot;</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="p">)</span>
        <span class="n">n_fit_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span>
        <span class="n">n_nui_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span>
        <span class="n">arr</span><span class="p">[:</span><span class="n">n_fit_p</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_random_fit_parameters</span>
        <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="p">:</span><span class="n">n_fit_p</span><span class="o">+</span><span class="n">n_nui_p</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_random_nuisance_parameters</span>
        <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="o">+</span><span class="n">n_nui_p</span><span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_random_wilson_coeffs</span>
        <span class="k">return</span> <span class="n">arr</span>

    <span class="k">def</span> <span class="nf">log_target</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the logarithm of the likelihood times prior probability&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood_exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_prior_parameters</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_prior_wilson_coeffs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">FastFit</span><span class="p">(</span><span class="n">Fit</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A fit class that is meant for producing fast likelihood contour plots.</span>

<span class="sd">    Calling the method `make_measurement`, a pseudo-measurement is generated</span>
<span class="sd">    that combines the actual experimental measurements with the theoretical</span>
<span class="sd">    uncertainties stemming from the nuisance parameters. This is done by</span>
<span class="sd">    generating random samples of the nuisance parameters and evaluating all</span>
<span class="sd">    observables within the Standard Model many times (100 by default).</span>
<span class="sd">    Then, the covariance of all predictions is extracted. Similarly, a covariance</span>
<span class="sd">    matrix for all experimental measurements is determined. Both covariance</span>
<span class="sd">    matrices are added and the resulting multivariate Gaussian treated as a</span>
<span class="sd">    single measurement.</span>

<span class="sd">    This approach has the advantage that two-dimensional plots of the likelihood</span>
<span class="sd">    can be produced without the need for sampling or profiling the other</span>
<span class="sd">    dimensions. However, several strong assumptions go into this method, most</span>
<span class="sd">    importantly,</span>

<span class="sd">    - all uncertainties - experimental and theoretical - are treated as Gaussian</span>
<span class="sd">    - the theoretical uncertainties in the presence of new physics are assumed</span>
<span class="sd">      to be equal to the ones in the SM</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurements</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sm_covariance</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_exp_central_covariance</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_predictions_array_sm</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_predictions_array</span><span class="p">,</span>
                                                 <span class="n">par</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">nuisance</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                                 <span class="n">wc</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>


    <span class="c1"># a method to get the mean and covariance of all measurements of all</span>
    <span class="c1"># observables of interest</span>
    <span class="k">def</span> <span class="nf">_get_central_covariance_experiment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">5000</span><span class="p">):</span>
        <span class="n">means</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">covariances</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">measurement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_measurements</span><span class="p">:</span>
            <span class="n">m_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">Measurement</span><span class="p">[</span><span class="n">measurement</span><span class="p">]</span>
            <span class="c1"># obs. included in the fit and constrained by this measurement</span>
            <span class="n">our_obs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span>
            <span class="c1"># construct a dict. containing a vector of N random values for</span>
            <span class="c1"># each of these observables</span>
            <span class="n">random_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">our_obs</span><span class="p">:</span>
                <span class="n">random_dict</span><span class="p">[</span><span class="n">obs</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
                <span class="n">m_random</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">get_random_all</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">our_obs</span><span class="p">:</span>
                    <span class="n">random_dict</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m_random</span><span class="p">[</span><span class="n">obs</span><span class="p">]</span>
            <span class="c1"># mean = np.zeros(len(self.observables))</span>
            <span class="n">random_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">),</span> <span class="n">N</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">):</span>
                <span class="c1">#     n = len(random_dict[obs])</span>
                <span class="k">if</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">our_obs</span><span class="p">:</span>
                    <span class="n">random_arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_dict</span><span class="p">[</span><span class="n">obs</span><span class="p">]</span>
            <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">random_arr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">covariance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">random_arr</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">obs</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">our_obs</span><span class="p">:</span>
                    <span class="n">covariance</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">covariance</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">covariance</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="n">means</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span>
            <span class="n">covariances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">covariance</span><span class="p">)</span>
        <span class="c1"># if there is only a single measuement</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">means</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">means</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># if there is only a single observable</span>
                <span class="k">return</span> <span class="n">means</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">covariances</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">means</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">covariances</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># if there are severeal measurements, perform a weighted average</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># covariances: [Sigma_1, Sigma_2, ...]</span>
            <span class="c1"># means: [x_1, x_2, ...]</span>
            <span class="c1"># weights_ [W_1, W_2, ...] where W_i = (Sigma_i)^(-1)</span>
            <span class="c1"># weighted covariance is  (W_1 + W_2 + ...)^(-1) = Sigma</span>
            <span class="c1"># weigted mean is  Sigma.(W_1.x_1 + W_2.x_2 + ...) = x</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="o">/</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">covariances</span><span class="p">])</span>
                <span class="n">weighted_covariance</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">weighted_mean</span> <span class="o">=</span> <span class="n">weighted_covariance</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">means</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">means</span><span class="p">))])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">covariances</span><span class="p">]</span>
                <span class="n">weighted_covariance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
                <span class="n">weighted_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">weighted_covariance</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">means</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">means</span><span class="p">))],</span>
                                <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">weighted_mean</span><span class="p">,</span> <span class="n">weighted_covariance</span>

    <span class="k">def</span> <span class="nf">get_exp_central_covariance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the experimental central values and the covriance matrix of</span>
<span class="sd">        all observables.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        - `N`: number of random computations (computing time is proportional</span>
<span class="sd">          to it; more means less random fluctuations.)</span>
<span class="sd">        - `force`: optional; if True (default), will recompute covariance even</span>
<span class="sd">          if it already has been computed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exp_central_covariance</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_exp_central_covariance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_central_covariance_experiment</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">N</span> <span class="o">!=</span> <span class="mi">5000</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Argument N={} ignored &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> \
                          <span class="s2">&quot;as experimental covariance has already been &quot;</span> <span class="o">+</span> \
                          <span class="s2">&quot;computed. Recompute with get_exp_central_covariance.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exp_central_covariance</span>

    <span class="k">def</span> <span class="nf">save_exp_central_covariance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save the experimental central values and the covriance to a pickle</span>
<span class="sd">        file.</span>

<span class="sd">        The central values and the covariance must have been computed before</span>
<span class="sd">        using `get_exp_central_covariance`.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exp_central_covariance</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Call get_exp_central_covariance or make_measurement first.&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">central</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_exp_central_covariance</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">covariance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_exp_central_covariance</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">observables</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_exp_central_covariance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the experimental central values and the covriance from a pickle</span>
<span class="sd">        file.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_exp_central_covariance_dict</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_exp_central_covariance_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the the experimental central values and the covriancee from a</span>
<span class="sd">        dictionary.</span>

<span class="sd">        It must have the form</span>
<span class="sd">        {&#39;observables&#39;: [...], &#39;central&#39;: [...], &#39;covariance&#39;: [[...]]}</span>
<span class="sd">        where &#39;central&#39; is a vector of central values and &#39;covariance&#39; is a</span>
<span class="sd">        covariance matrix, both in the basis of observables given by</span>
<span class="sd">        &#39;observables&#39; which must at least contain all the observables</span>
<span class="sd">        involved in the fit. Additional observables will be ignored; the</span>
<span class="sd">        ordering is arbitrary.&quot;&quot;&quot;</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;observables&#39;</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">permutation</span> <span class="o">=</span> <span class="p">[</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Covariance matrix does not contain all necessary entries&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">permutation</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">),</span> \
            <span class="s2">&quot;Covariance matrix does not contain all necessary entries&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">permutation</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_exp_central_covariance</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;central&#39;</span><span class="p">],</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_exp_central_covariance</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;central&#39;</span><span class="p">][</span><span class="n">permutation</span><span class="p">],</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">][</span><span class="n">permutation</span><span class="p">][:,</span><span class="n">permutation</span><span class="p">],</span>
            <span class="p">)</span>

    <span class="c1"># a method to get the covariance of the SM prediction of all observables</span>
    <span class="c1"># of interest</span>
    <span class="k">def</span> <span class="nf">_get_random_nuisance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_random</span><span class="p">(</span><span class="n">par</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">nuisance</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">wc</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_covariance_sm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">threads</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">X_map</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_random_nuisance</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
            <span class="n">pred_map</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_predictions_array_sm</span><span class="p">,</span> <span class="n">X_map</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pool</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="n">threads</span><span class="p">)</span>
            <span class="n">X_map</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_random_nuisance</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
            <span class="n">pred_map</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_predictions_array_sm</span><span class="p">,</span> <span class="n">X_map</span><span class="p">)</span>
            <span class="n">pool</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">pool</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="n">pred_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pred_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pred_map</span><span class="p">):</span>
            <span class="n">pred_arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">pred_i</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">pred_arr</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_sm_covariance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the covriance matrix of the SM predictions of all observables</span>
<span class="sd">        under variation of all nuisance parameters.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        - `N`: number of random computations (computing time is proportional</span>
<span class="sd">          to it; more means less random fluctuations.)</span>
<span class="sd">        - `threads`: optional; number of parallel threads. Defaults to 1 (no</span>
<span class="sd">          parallelization)</span>
<span class="sd">        - `force`: optional; if True (default), will recompute covariance even</span>
<span class="sd">          if it already has been computed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sm_covariance</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sm_covariance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_covariance_sm</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">N</span> <span class="o">!=</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Argument N={} ignored &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> \
                          <span class="s2">&quot;as SM covariance has already &quot;</span> <span class="o">+</span> \
                          <span class="s2">&quot;been computed. Recompute with get_sm_covariance.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sm_covariance</span>

    <span class="k">def</span> <span class="nf">save_sm_covariance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save the SM covariance to a pickle file.</span>

<span class="sd">        The covariance must have been computed before using</span>
<span class="sd">        `get_sm_covariance`.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sm_covariance</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Call get_sm_covariance or make_measurement first.&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">covariance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sm_covariance</span><span class="p">,</span>
                        <span class="n">observables</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_sm_covariance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the SM covariance from a pickle file.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_sm_covariance_dict</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_sm_covariance_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the SM covariance from a dictionary.</span>

<span class="sd">        It must have the form {&#39;observables&#39;: [...], &#39;covariance&#39;: [[...]]}</span>
<span class="sd">        where &#39;covariance&#39; is a covariance matrix in the basis of observables</span>
<span class="sd">        given by &#39;observables&#39; which must at least contain all the observables</span>
<span class="sd">        involved in the fit. Additional observables will be ignored; the</span>
<span class="sd">        ordering is arbitrary.&quot;&quot;&quot;</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;observables&#39;</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">permutation</span> <span class="o">=</span> <span class="p">[</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Covariance matrix does not contain all necessary entries&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">permutation</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">),</span> \
            <span class="s2">&quot;Covariance matrix does not contain all necessary entries&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">permutation</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sm_covariance</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sm_covariance</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">][</span><span class="n">permutation</span><span class="p">][:,</span><span class="n">permutation</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sm_covariance</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">][</span><span class="n">permutation</span><span class="p">][:,</span><span class="n">permutation</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">make_measurement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Nexp</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">force_exp</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the fit by producing a pseudo-measurement containing both</span>
<span class="sd">        experimental uncertainties as well as theory uncertainties stemming</span>
<span class="sd">        from nuisance parameters.</span>

<span class="sd">        Optional parameters:</span>

<span class="sd">        - `N`: number of random computations for the SM covariance (computing</span>
<span class="sd">          time is proportional to it; more means less random fluctuations.)</span>
<span class="sd">        - `Nexp`: number of random computations for the experimental covariance.</span>
<span class="sd">          This is much less expensive than the theory covariance, so a large</span>
<span class="sd">          number can be afforded (default: 5000).</span>
<span class="sd">        - `threads`: number of parallel threads for the SM</span>
<span class="sd">          covariance computation. Defaults to 1 (no parallelization).</span>
<span class="sd">        - `force`: if True, will recompute SM covariance even if it</span>
<span class="sd">          already has been computed. Defaults to False.</span>
<span class="sd">        - `force_exp`: if True, will recompute experimental central values and</span>
<span class="sd">          covariance even if they have already been computed. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">central_exp</span><span class="p">,</span> <span class="n">cov_exp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_exp_central_covariance</span><span class="p">(</span><span class="n">Nexp</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force_exp</span><span class="p">)</span>
        <span class="n">cov_sm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sm_covariance</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span>
        <span class="n">covariance</span> <span class="o">=</span> <span class="n">cov_exp</span> <span class="o">+</span> <span class="n">cov_sm</span>
        <span class="c1"># add the Pseudo-measurement</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Measurement</span><span class="p">(</span><span class="s1">&#39;Pseudo-measurement for FastFit instance: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">central_exp</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">central_exp</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># for a 1D (or 0D) array</span>
            <span class="n">m</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">,</span>
                    <span class="n">NormalDistribution</span><span class="p">(</span><span class="n">central_exp</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">covariance</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">,</span>
                    <span class="n">MultivariateNormalDistribution</span><span class="p">(</span><span class="n">central_exp</span><span class="p">,</span> <span class="n">covariance</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">shortarray_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a 1D numpy array of floats to a dictionary of fit parameters</span>
<span class="sd">        and Wilson coefficients.&quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">n_fit_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span>
        <span class="n">n_wc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">p</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span> <span class="p">}</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_wc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">p</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">n_fit_p</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span> <span class="p">}</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="k">def</span> <span class="nf">dict_to_shortarray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a dictionary of fit parameters and Wilson coefficients to a</span>
<span class="sd">        1D numpy array of floats.&quot;&quot;&quot;</span>
        <span class="n">n_fit_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span>
        <span class="n">n_wc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_fit_p</span> <span class="o">+</span> <span class="n">n_nui_p</span> <span class="o">+</span> <span class="n">n_wc</span><span class="p">)</span>
        <span class="n">arr</span><span class="p">[:</span><span class="n">n_fit_p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_parameters&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">]</span>
        <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="p">:]</span>   <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_wc&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">arr</span>

    <span class="k">def</span> <span class="nf">shortarray_to_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert an array of fit parameters and Wilson coefficients to an</span>
<span class="sd">        array of fit parameters, nuisance parameters, and Wilson coefficients</span>
<span class="sd">        (setting nuisance parameters to their central values).&quot;&quot;&quot;</span>
        <span class="n">n_fit_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span>
        <span class="n">n_nui_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span>
        <span class="n">n_wc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_fit_p</span> <span class="o">+</span> <span class="n">n_nui_p</span> <span class="o">+</span> <span class="n">n_wc</span><span class="p">)</span>
        <span class="n">arr</span><span class="p">[:</span><span class="n">n_fit_p</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:</span><span class="n">n_fit_p</span><span class="p">]</span>
        <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="p">:</span><span class="n">n_fit_p</span><span class="o">+</span><span class="n">n_nui_p</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_central_nuisance_parameters</span>
        <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="o">+</span><span class="n">n_nui_p</span><span class="p">:]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">n_fit_p</span><span class="p">:]</span>
        <span class="k">return</span> <span class="n">arr</span>

    <span class="k">def</span> <span class="nf">log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the logarithm of the likelihood. Note that there is no prior</span>
<span class="sd">        probability for nuisance parameters, which have been integrated out.</span>
<span class="sd">        Priors for fit parameters are ignored.&quot;&quot;&quot;</span>
         <span class="c1"># set nuisance parameters to their central values!</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_predictions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shortarray_to_array</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">nuisance</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">m_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">Measurement</span><span class="p">[</span><span class="s1">&#39;Pseudo-measurement for FastFit instance: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="n">m_obs</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span>
        <span class="n">prob_dict</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">prob_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">ll</span>

    <span class="k">def</span> <span class="nf">best_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compute the best fit point in the space of fit parameters and Wilson</span>
<span class="sd">        coefficients.</span>

<span class="sd">        Keyword arguments will be passed to `scipy.optimize.minimize_scalar` in</span>
<span class="sd">        the case of a single fit variable and to `flavio.math.optimize.minimize_robust`</span>
<span class="sd">        in the case of multiple fit variables.</span>

<span class="sd">        Returns a dictionary with the following keys:</span>

<span class="sd">        - &#39;x&#39;: position of the best fit point</span>
<span class="sd">        - &#39;log_likelihood&#39;: logarithm of the likelihood at the best fit point</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n_fit_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span>
        <span class="n">n_wc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n_fit_p</span> <span class="o">+</span> <span class="n">n_wc</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">([</span><span class="n">x</span><span class="p">])</span>
            <span class="n">opt</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">minimize_scalar</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;x0&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_fit_p</span> <span class="o">+</span> <span class="n">n_wc</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">n_fit_p</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">x0</span><span class="p">[:</span><span class="n">n_fit_p</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_central_fit_parameters</span>
                <span class="n">opt</span> <span class="o">=</span> <span class="n">minimize_robust</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">opt</span> <span class="o">=</span> <span class="n">minimize_robust</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">opt</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Optimization failed.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">opt</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;log_likelihood&#39;</span><span class="p">:</span> <span class="o">-</span><span class="n">opt</span><span class="o">.</span><span class="n">fun</span><span class="p">}</span>


<span class="k">class</span> <span class="nc">FrequentistFit</span><span class="p">(</span><span class="n">Fit</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Frequentist fit class.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    - `name`: a descriptive string name</span>
<span class="sd">    - `par_obj`: optional; an instance of `ParameterConstraints`.</span>
<span class="sd">      Defaults to `flavio.default_parameters`</span>
<span class="sd">    - `fit_parameters`: a list of string names of parameters of interest.</span>
<span class="sd">      Existing constraints on the parameter will be ignored.</span>
<span class="sd">    - `nuisance_parameters`: a list of string names of nuisance parameters. The existing</span>
<span class="sd">      constraints on the parameter will be interpreted as pseudo-measurement</span>
<span class="sd">      entering the likelihood.</span>
<span class="sd">    - `observables`: a list of observable names to be included in the fit</span>
<span class="sd">    - `exclude_measurements`: optional; a list of measurement names *not* to be included in</span>
<span class="sd">    the fit. By default, all existing measurements are included.</span>
<span class="sd">    - `include_measurements`: optional; a list of measurement names to be included in</span>
<span class="sd">    the fit. By default, all existing measurements are included.</span>
<span class="sd">    - `fit_wc_names`: optional; a list of string names of arguments of the Wilson</span>
<span class="sd">      coefficient function below</span>
<span class="sd">    - `fit_wc_function`: optional; a function that</span>
<span class="sd">      returns a dictionary that can be fed to the `set_initial`</span>
<span class="sd">      method of the Wilson coefficient class. Example: fit the real and imaginary</span>
<span class="sd">      parts of $C_{10}$ in $b\to s\mu^+\mu^-$.</span>
<span class="sd">    ```</span>
<span class="sd">    def fit_wc_function(Re_C10, Im_C10):</span>
<span class="sd">        return {&#39;C10_bsmmumu&#39;: Re_C10 + 1j*Im_C10}</span>
<span class="sd">    ```</span>
<span class="sd">    - `input_scale`: input scale for the Wilson coeffficients. Defaults to 160.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the logarithm of the likelihood function (including the</span>
<span class="sd">        lihelihood of nuisance parameters!)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood_exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_prior_nuisance_parameters</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>

  </div>

  </header>

  <section id="section-items">


    <h2 class="section-title" id="header-classes">Classes</h2>
      
      <div class="item">
      <p id="flavio.statistics.fits.BayesianFit" class="name">class <span class="ident">BayesianFit</span></p>
      
  
    <div class="desc"><p>Bayesian fit class. Instances of this class can then be fed to samplers.</p>
<h2>Parameters</h2>
<ul>
<li><code>name</code>: a descriptive string name</li>
<li><code>par_obj</code>: optional; an instance of <code>ParameterConstraints</code>.
  Defaults to <code>flavio.default_parameters</code></li>
<li><code>fit_parameters</code>: a list of string names of parameters of interest. The existing
  constraints on the parameter will be taken as prior.</li>
<li><code>nuisance_parameters</code>: a list of string names of nuisance parameters. The existing
  constraints on the parameter will be taken as prior. Alternatively, it
  can also be set to 'all', in which case all the parameters constrainted
  by <code>par_obj</code> will be treated as nuisance parameters. (Note that this makes
  sense for <code>FastFit</code>, but not for a MCMC since the number of nuisance
  parameters will be huge.)</li>
<li><code>observables</code>: a list of observable names to be included in the fit</li>
<li><code>exclude_measurements</code>: optional; a list of measurement names <em>not</em> to be included in
the fit. By default, all existing measurements are included.</li>
<li><code>include_measurements</code>: optional; a list of measurement names to be included in
the fit. By default, all existing measurements are included.</li>
<li><code>fit_wc_names</code>: optional; a list of string names of arguments of the Wilson
  coefficient function below</li>
<li><code>fit_wc_function</code>: optional; a function that
  returns a dictionary that can be fed to the <code>set_initial</code>
  method of the Wilson coefficient class. Example: fit the real and imaginary
  parts of $C_{10}$ in $b\to s\mu^+\mu^-$.
<code>def fit_wc_function(Re_C10, Im_C10):
    return {'C10_bsmmumu': Re_C10 + 1j*Im_C10}</code></li>
<li><code>input_scale</code>: input scale for the Wilson coeffficients. Defaults to 160.</li>
<li><code>fit_wc_priors</code>: optional; an instance of WilsonCoefficientPriors
  containing prior constraints on the Wilson coefficients</li>
<li><code>start_wc_priors</code>: optional; an instance of WilsonCoefficientPriors
  that will not be used during a scan, but only for finding starting values
  for Wilson coefficients in MCMC analyses. This can be useful if no
  actual priors are used or if they are too loose to provide good starting
  points.</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.BayesianFit', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.BayesianFit" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">BayesianFit</span><span class="p">(</span><span class="n">Fit</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Bayesian fit class. Instances of this class can then be fed to samplers.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    - `name`: a descriptive string name</span>
<span class="sd">    - `par_obj`: optional; an instance of `ParameterConstraints`.</span>
<span class="sd">      Defaults to `flavio.default_parameters`</span>
<span class="sd">    - `fit_parameters`: a list of string names of parameters of interest. The existing</span>
<span class="sd">      constraints on the parameter will be taken as prior.</span>
<span class="sd">    - `nuisance_parameters`: a list of string names of nuisance parameters. The existing</span>
<span class="sd">      constraints on the parameter will be taken as prior. Alternatively, it</span>
<span class="sd">      can also be set to &#39;all&#39;, in which case all the parameters constrainted</span>
<span class="sd">      by `par_obj` will be treated as nuisance parameters. (Note that this makes</span>
<span class="sd">      sense for `FastFit`, but not for a MCMC since the number of nuisance</span>
<span class="sd">      parameters will be huge.)</span>
<span class="sd">    - `observables`: a list of observable names to be included in the fit</span>
<span class="sd">    - `exclude_measurements`: optional; a list of measurement names *not* to be included in</span>
<span class="sd">    the fit. By default, all existing measurements are included.</span>
<span class="sd">    - `include_measurements`: optional; a list of measurement names to be included in</span>
<span class="sd">    the fit. By default, all existing measurements are included.</span>
<span class="sd">    - `fit_wc_names`: optional; a list of string names of arguments of the Wilson</span>
<span class="sd">      coefficient function below</span>
<span class="sd">    - `fit_wc_function`: optional; a function that</span>
<span class="sd">      returns a dictionary that can be fed to the `set_initial`</span>
<span class="sd">      method of the Wilson coefficient class. Example: fit the real and imaginary</span>
<span class="sd">      parts of $C_{10}$ in $b\to s\mu^+\mu^-$.</span>
<span class="sd">    ```</span>
<span class="sd">    def fit_wc_function(Re_C10, Im_C10):</span>
<span class="sd">        return {&#39;C10_bsmmumu&#39;: Re_C10 + 1j*Im_C10}</span>
<span class="sd">    ```</span>
<span class="sd">    - `input_scale`: input scale for the Wilson coeffficients. Defaults to 160.</span>
<span class="sd">    - `fit_wc_priors`: optional; an instance of WilsonCoefficientPriors</span>
<span class="sd">      containing prior constraints on the Wilson coefficients</span>
<span class="sd">    - `start_wc_priors`: optional; an instance of WilsonCoefficientPriors</span>
<span class="sd">      that will not be used during a scan, but only for finding starting values</span>
<span class="sd">      for Wilson coefficients in MCMC analyses. This can be useful if no</span>
<span class="sd">      actual priors are used or if they are too loose to provide good starting</span>
<span class="sd">      points.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">start_wc_priors</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_wc_priors</span> <span class="o">=</span> <span class="n">start_wc_priors</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">:</span>
            <span class="c1"># check that fit parameters are constrained</span>
            <span class="k">assert</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">_parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="s2">&quot;Parameter &quot;</span> <span class="o">+</span> <span class="n">p</span> <span class="o">+</span> <span class="s2">&quot; not found in Constraints&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_random</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get an array with random values for all the fit and nuisance</span>
<span class="sd">        parameters&quot;&quot;&quot;</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="p">)</span>
        <span class="n">n_fit_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span>
        <span class="n">n_nui_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span>
        <span class="n">arr</span><span class="p">[:</span><span class="n">n_fit_p</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_random_fit_parameters</span>
        <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="p">:</span><span class="n">n_fit_p</span><span class="o">+</span><span class="n">n_nui_p</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_random_nuisance_parameters</span>
        <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="o">+</span><span class="n">n_nui_p</span><span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_random_wilson_coeffs</span>
        <span class="k">return</span> <span class="n">arr</span>

    <span class="k">def</span> <span class="nf">log_target</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the logarithm of the likelihood times prior probability&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood_exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_prior_parameters</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_prior_wilson_coeffs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#flavio.statistics.fits.BayesianFit">BayesianFit</a></li>
          <li><a href="#flavio.statistics.fits.Fit">Fit</a></li>
          <li>flavio.classes.NamedInstanceClass</li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.BayesianFit.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, *args, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialize self.  See help(type(self)) for accurate signature.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.BayesianFit.__init__', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.BayesianFit.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">start_wc_priors</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">start_wc_priors</span> <span class="o">=</span> <span class="n">start_wc_priors</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">:</span>
        <span class="c1"># check that fit parameters are constrained</span>
        <span class="k">assert</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">_parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="s2">&quot;Parameter &quot;</span> <span class="o">+</span> <span class="n">p</span> <span class="o">+</span> <span class="s2">&quot; not found in Constraints&quot;</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.BayesianFit.array_to_dict">
    <p>def <span class="ident">array_to_dict</span>(</p><p>self, x)</p>
    </div>
    

    
  
    <div class="desc"><p>Convert a 1D numpy array of floats to a dictionary of fit parameters,
nuisance parameters, and Wilson coefficients.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.BayesianFit.array_to_dict', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.BayesianFit.array_to_dict" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">array_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a 1D numpy array of floats to a dictionary of fit parameters,</span>
<span class="sd">    nuisance parameters, and Wilson coefficients.&quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">n_fit_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span>
    <span class="n">n_nui_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span>
    <span class="n">n_wc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">p</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;nuisance_parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">p</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">n_fit_p</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_wc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">p</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">n_fit_p</span> <span class="o">+</span> <span class="n">n_nui_p</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span> <span class="p">}</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.BayesianFit.dict_to_array">
    <p>def <span class="ident">dict_to_array</span>(</p><p>self, d)</p>
    </div>
    

    
  
    <div class="desc"><p>Convert a dictionary of fit parameters,
nuisance parameters, and Wilson coefficients to a 1D numpy array of
floats.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.BayesianFit.dict_to_array', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.BayesianFit.dict_to_array" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">dict_to_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a dictionary of fit parameters,</span>
<span class="sd">    nuisance parameters, and Wilson coefficients to a 1D numpy array of</span>
<span class="sd">    floats.&quot;&quot;&quot;</span>
    <span class="n">n_fit_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span>
    <span class="n">n_nui_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span>
    <span class="n">n_wc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_fit_p</span> <span class="o">+</span> <span class="n">n_nui_p</span> <span class="o">+</span> <span class="n">n_wc</span><span class="p">)</span>
    <span class="n">arr</span><span class="p">[:</span><span class="n">n_fit_p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_parameters&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">]</span>
    <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="p">:</span><span class="n">n_fit_p</span><span class="o">+</span><span class="n">n_nui_p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;nuisance_parameters&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">]</span>
    <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="o">+</span><span class="n">n_nui_p</span><span class="p">:]</span>   <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_wc&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">arr</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.BayesianFit.get_par_dict">
    <p>def <span class="ident">get_par_dict</span>(</p><p>self, x, par=True, nuisance=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Get a dictionary of fit and nuisance parameters from an input array</p>
<p>If par is False, fit parameters are set to their central values.
If nuisance is False, nuisance parameters are set to their central values.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.BayesianFit.get_par_dict', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.BayesianFit.get_par_dict" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_par_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">par</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nuisance</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get a dictionary of fit and nuisance parameters from an input array</span>
<span class="sd">    If par is False, fit parameters are set to their central values.</span>
<span class="sd">    If nuisance is False, nuisance parameters are set to their central values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array_to_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">par_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters_central</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">par</span><span class="p">:</span>
        <span class="n">par_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_parameters&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">nuisance</span><span class="p">:</span>
        <span class="n">par_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;nuisance_parameters&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">par_dict</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.BayesianFit.get_predictions">
    <p>def <span class="ident">get_predictions</span>(</p><p>self, x, par=True, nuisance=True, wc=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Get a dictionary with predictions for all observables given an input
array.</p>
<p>If par is False, fit parameters are set to their central values.
If nuisance is False, nuisance parameters are set to their central values.
If wc is False, Wilson coefficients are set to their SM values.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.BayesianFit.get_predictions', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.BayesianFit.get_predictions" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">par</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nuisance</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">wc</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get a dictionary with predictions for all observables given an input</span>
<span class="sd">    array.</span>
<span class="sd">    If par is False, fit parameters are set to their central values.</span>
<span class="sd">    If nuisance is False, nuisance parameters are set to their central values.</span>
<span class="sd">    If wc is False, Wilson coefficients are set to their SM values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">par_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_par_dict</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">par</span><span class="o">=</span><span class="n">par</span><span class="p">,</span> <span class="n">nuisance</span><span class="o">=</span><span class="n">nuisance</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wc</span><span class="p">:</span>
        <span class="n">wc_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wc_obj</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">wc_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">physics</span><span class="o">.</span><span class="n">eft</span><span class="o">.</span><span class="n">_wc_sm</span>
    <span class="n">all_predictions</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">observable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">observable</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">obs_name</span> <span class="o">=</span> <span class="n">observable</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">_inst</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="p">[</span><span class="n">obs_name</span><span class="p">]</span>
            <span class="n">all_predictions</span><span class="p">[</span><span class="n">observable</span><span class="p">]</span> <span class="o">=</span> <span class="n">_inst</span><span class="o">.</span><span class="n">prediction_par</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="o">*</span><span class="n">observable</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_inst</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="p">[</span><span class="n">observable</span><span class="p">]</span>
            <span class="n">all_predictions</span><span class="p">[</span><span class="n">observable</span><span class="p">]</span> <span class="o">=</span> <span class="n">_inst</span><span class="o">.</span><span class="n">prediction_par</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">all_predictions</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.BayesianFit.get_predictions_array">
    <p>def <span class="ident">get_predictions_array</span>(</p><p>self, x, **kwargs)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.BayesianFit.get_predictions_array', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.BayesianFit.get_predictions_array" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_predictions_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_predictions</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pred</span><span class="p">[</span><span class="n">obs</span><span class="p">]</span> <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.BayesianFit.get_wc_obj">
    <p>def <span class="ident">get_wc_obj</span>(</p><p>self, x)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.BayesianFit.get_wc_obj', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.BayesianFit.get_wc_obj" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_wc_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="n">wc_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">WilsonCoefficients</span><span class="p">()</span>
    <span class="c1"># if there are no WCs to be fitted, return the SM WCs</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">wc_obj</span>
    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array_to_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">wc_obj</span><span class="o">.</span><span class="n">set_initial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_function</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_wc&#39;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_scale</span><span class="p">,</span>
                       <span class="n">eft</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eft</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">basis</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wc_obj</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.BayesianFit.log_likelihood_exp">
    <p>def <span class="ident">log_likelihood_exp</span>(</p><p>self, x)</p>
    </div>
    

    
  
    <div class="desc"><p>Return the logarithm of the likelihood function (not including the
prior)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.BayesianFit.log_likelihood_exp', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.BayesianFit.log_likelihood_exp" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">log_likelihood_exp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the logarithm of the likelihood function (not including the</span>
<span class="sd">    prior)&quot;&quot;&quot;</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_predictions</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">for</span> <span class="n">measurement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_measurements</span><span class="p">:</span>
        <span class="n">m_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">Measurement</span><span class="p">[</span><span class="n">measurement</span><span class="p">]</span>
        <span class="n">m_obs</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span>
        <span class="n">exclude_observables</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">m_obs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span>
        <span class="n">prob_dict</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">exclude_parameters</span><span class="o">=</span><span class="n">exclude_observables</span><span class="p">)</span>
        <span class="n">ll</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">prob_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">ll</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.BayesianFit.log_prior_nuisance_parameters">
    <p>def <span class="ident">log_prior_nuisance_parameters</span>(</p><p>self, x)</p>
    </div>
    

    
  
    <div class="desc"><p>Return the prior probability (or frequentist likelihood) for all
nuisance parameters given an input array</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.BayesianFit.log_prior_nuisance_parameters', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.BayesianFit.log_prior_nuisance_parameters" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">log_prior_nuisance_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the prior probability (or frequentist likelihood) for all</span>
<span class="sd">    nuisance parameters given an input array&quot;&quot;&quot;</span>
    <span class="n">par_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_par_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">exclude_parameters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">par_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">))</span>
    <span class="n">prob_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">exclude_parameters</span><span class="o">=</span><span class="n">exclude_parameters</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prob_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.BayesianFit.log_prior_parameters">
    <p>def <span class="ident">log_prior_parameters</span>(</p><p>self, x)</p>
    </div>
    

    
  
    <div class="desc"><p>Return the prior probability (or frequentist likelihood) for all
fit and (!) nuisance parameters given an input array</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.BayesianFit.log_prior_parameters', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.BayesianFit.log_prior_parameters" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">log_prior_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the prior probability (or frequentist likelihood) for all</span>
<span class="sd">    fit and (!) nuisance parameters given an input array&quot;&quot;&quot;</span>
    <span class="n">par_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_par_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">exclude_parameters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">par_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">))</span>
    <span class="n">prob_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">exclude_parameters</span><span class="o">=</span><span class="n">exclude_parameters</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prob_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.BayesianFit.log_prior_wilson_coeffs">
    <p>def <span class="ident">log_prior_wilson_coeffs</span>(</p><p>self, x)</p>
    </div>
    

    
  
    <div class="desc"><p>Return the prior probability for all Wilson coefficients
given an input array</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.BayesianFit.log_prior_wilson_coeffs', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.BayesianFit.log_prior_wilson_coeffs" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">log_prior_wilson_coeffs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the prior probability for all Wilson coefficients</span>
<span class="sd">    given an input array&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_priors</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="n">wc_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array_to_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="s1">&#39;fit_wc&#39;</span><span class="p">]</span>
    <span class="n">prob_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_priors</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">wc_dict</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prob_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.BayesianFit.log_target">
    <p>def <span class="ident">log_target</span>(</p><p>self, x)</p>
    </div>
    

    
  
    <div class="desc"><p>Return the logarithm of the likelihood times prior probability</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.BayesianFit.log_target', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.BayesianFit.log_target" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">log_target</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the logarithm of the likelihood times prior probability&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood_exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_prior_parameters</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_prior_wilson_coeffs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.BayesianFit.set_description">
    <p>def <span class="ident">set_description</span>(</p><p>self, description)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.BayesianFit.set_description', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.BayesianFit.set_description" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="flavio.statistics.fits.BayesianFit.get_central_fit_parameters" class="name">var <span class="ident">get_central_fit_parameters</span></p>
            

            
  
    <div class="desc"><p>Return a numpy array with the central values of all fit parameters.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.BayesianFit.get_central_nuisance_parameters" class="name">var <span class="ident">get_central_nuisance_parameters</span></p>
            

            
  
    <div class="desc"><p>Return a numpy array with the central values of all nuisance parameters.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.BayesianFit.get_measurements" class="name">var <span class="ident">get_measurements</span></p>
            

            
  
    <div class="desc"><p>Return a list of all the measurements currently defined that
constrain any of the fit observables.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.BayesianFit.get_random" class="name">var <span class="ident">get_random</span></p>
            

            
  
    <div class="desc"><p>Get an array with random values for all the fit and nuisance
parameters</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.BayesianFit.get_random_fit_parameters" class="name">var <span class="ident">get_random_fit_parameters</span></p>
            

            
  
    <div class="desc"><p>Return a numpy array with random values for all fit parameters.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.BayesianFit.get_random_nuisance_parameters" class="name">var <span class="ident">get_random_nuisance_parameters</span></p>
            

            
  
    <div class="desc"><p>Return a numpy array with random values for all nuisance parameters.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.BayesianFit.get_random_start" class="name">var <span class="ident">get_random_start</span></p>
            

            
  
    <div class="desc"><p>Get an array with random values for all the fit and nuisance
parameters with Wilson coefficients set to their SM values</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.BayesianFit.get_random_wilson_coeffs" class="name">var <span class="ident">get_random_wilson_coeffs</span></p>
            

            
  
    <div class="desc"><p>Return a numpy array with random values for all Wilson coefficients.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.BayesianFit.get_random_wilson_coeffs_start" class="name">var <span class="ident">get_random_wilson_coeffs_start</span></p>
            

            
  
    <div class="desc"><p>Return a numpy array with random values for all Wilson coefficients
sampling the start_wc_priors distribution.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.BayesianFit.start_wc_priors" class="name">var <span class="ident">start_wc_priors</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.BayesianFit.clear_all">
    <p>def <span class="ident">clear_all</span>(</p><p>cls)</p>
    </div>
    

    
  
    <div class="desc"><p>Delete all instances.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.BayesianFit.clear_all', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.BayesianFit.clear_all" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">clear_all</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Delete all instances.&quot;&quot;&quot;</span>
    <span class="bp">cls</span><span class="o">.</span><span class="n">instances</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.BayesianFit.del_instance">
    <p>def <span class="ident">del_instance</span>(</p><p>cls, name)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.BayesianFit.del_instance', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.BayesianFit.del_instance" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">del_instance</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="k">del</span> <span class="bp">cls</span><span class="o">.</span><span class="n">instances</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.BayesianFit.get_instance">
    <p>def <span class="ident">get_instance</span>(</p><p>cls, name)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.BayesianFit.get_instance', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.BayesianFit.get_instance" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">get_instance</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">instances</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="flavio.statistics.fits.FastFit" class="name">class <span class="ident">FastFit</span></p>
      
  
    <div class="desc"><p>A fit class that is meant for producing fast likelihood contour plots.</p>
<p>Calling the method <code>make_measurement</code>, a pseudo-measurement is generated
that combines the actual experimental measurements with the theoretical
uncertainties stemming from the nuisance parameters. This is done by
generating random samples of the nuisance parameters and evaluating all
observables within the Standard Model many times (100 by default).
Then, the covariance of all predictions is extracted. Similarly, a covariance
matrix for all experimental measurements is determined. Both covariance
matrices are added and the resulting multivariate Gaussian treated as a
single measurement.</p>
<p>This approach has the advantage that two-dimensional plots of the likelihood
can be produced without the need for sampling or profiling the other
dimensions. However, several strong assumptions go into this method, most
importantly,</p>
<ul>
<li>all uncertainties - experimental and theoretical - are treated as Gaussian</li>
<li>the theoretical uncertainties in the presence of new physics are assumed
  to be equal to the ones in the SM</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FastFit', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FastFit" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">FastFit</span><span class="p">(</span><span class="n">Fit</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A fit class that is meant for producing fast likelihood contour plots.</span>

<span class="sd">    Calling the method `make_measurement`, a pseudo-measurement is generated</span>
<span class="sd">    that combines the actual experimental measurements with the theoretical</span>
<span class="sd">    uncertainties stemming from the nuisance parameters. This is done by</span>
<span class="sd">    generating random samples of the nuisance parameters and evaluating all</span>
<span class="sd">    observables within the Standard Model many times (100 by default).</span>
<span class="sd">    Then, the covariance of all predictions is extracted. Similarly, a covariance</span>
<span class="sd">    matrix for all experimental measurements is determined. Both covariance</span>
<span class="sd">    matrices are added and the resulting multivariate Gaussian treated as a</span>
<span class="sd">    single measurement.</span>

<span class="sd">    This approach has the advantage that two-dimensional plots of the likelihood</span>
<span class="sd">    can be produced without the need for sampling or profiling the other</span>
<span class="sd">    dimensions. However, several strong assumptions go into this method, most</span>
<span class="sd">    importantly,</span>

<span class="sd">    - all uncertainties - experimental and theoretical - are treated as Gaussian</span>
<span class="sd">    - the theoretical uncertainties in the presence of new physics are assumed</span>
<span class="sd">      to be equal to the ones in the SM</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurements</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sm_covariance</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_exp_central_covariance</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_predictions_array_sm</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_predictions_array</span><span class="p">,</span>
                                                 <span class="n">par</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">nuisance</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                                 <span class="n">wc</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>


    <span class="c1"># a method to get the mean and covariance of all measurements of all</span>
    <span class="c1"># observables of interest</span>
    <span class="k">def</span> <span class="nf">_get_central_covariance_experiment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">5000</span><span class="p">):</span>
        <span class="n">means</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">covariances</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">measurement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_measurements</span><span class="p">:</span>
            <span class="n">m_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">Measurement</span><span class="p">[</span><span class="n">measurement</span><span class="p">]</span>
            <span class="c1"># obs. included in the fit and constrained by this measurement</span>
            <span class="n">our_obs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span>
            <span class="c1"># construct a dict. containing a vector of N random values for</span>
            <span class="c1"># each of these observables</span>
            <span class="n">random_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">our_obs</span><span class="p">:</span>
                <span class="n">random_dict</span><span class="p">[</span><span class="n">obs</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
                <span class="n">m_random</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">get_random_all</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">our_obs</span><span class="p">:</span>
                    <span class="n">random_dict</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m_random</span><span class="p">[</span><span class="n">obs</span><span class="p">]</span>
            <span class="c1"># mean = np.zeros(len(self.observables))</span>
            <span class="n">random_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">),</span> <span class="n">N</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">):</span>
                <span class="c1">#     n = len(random_dict[obs])</span>
                <span class="k">if</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">our_obs</span><span class="p">:</span>
                    <span class="n">random_arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_dict</span><span class="p">[</span><span class="n">obs</span><span class="p">]</span>
            <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">random_arr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">covariance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">random_arr</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">obs</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">our_obs</span><span class="p">:</span>
                    <span class="n">covariance</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">covariance</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">covariance</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="n">means</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span>
            <span class="n">covariances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">covariance</span><span class="p">)</span>
        <span class="c1"># if there is only a single measuement</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">means</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">means</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># if there is only a single observable</span>
                <span class="k">return</span> <span class="n">means</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">covariances</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">means</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">covariances</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># if there are severeal measurements, perform a weighted average</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># covariances: [Sigma_1, Sigma_2, ...]</span>
            <span class="c1"># means: [x_1, x_2, ...]</span>
            <span class="c1"># weights_ [W_1, W_2, ...] where W_i = (Sigma_i)^(-1)</span>
            <span class="c1"># weighted covariance is  (W_1 + W_2 + ...)^(-1) = Sigma</span>
            <span class="c1"># weigted mean is  Sigma.(W_1.x_1 + W_2.x_2 + ...) = x</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="o">/</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">covariances</span><span class="p">])</span>
                <span class="n">weighted_covariance</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">weighted_mean</span> <span class="o">=</span> <span class="n">weighted_covariance</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">means</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">means</span><span class="p">))])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">covariances</span><span class="p">]</span>
                <span class="n">weighted_covariance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
                <span class="n">weighted_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">weighted_covariance</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">means</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">means</span><span class="p">))],</span>
                                <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">weighted_mean</span><span class="p">,</span> <span class="n">weighted_covariance</span>

    <span class="k">def</span> <span class="nf">get_exp_central_covariance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the experimental central values and the covriance matrix of</span>
<span class="sd">        all observables.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        - `N`: number of random computations (computing time is proportional</span>
<span class="sd">          to it; more means less random fluctuations.)</span>
<span class="sd">        - `force`: optional; if True (default), will recompute covariance even</span>
<span class="sd">          if it already has been computed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exp_central_covariance</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_exp_central_covariance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_central_covariance_experiment</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">N</span> <span class="o">!=</span> <span class="mi">5000</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Argument N={} ignored &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> \
                          <span class="s2">&quot;as experimental covariance has already been &quot;</span> <span class="o">+</span> \
                          <span class="s2">&quot;computed. Recompute with get_exp_central_covariance.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exp_central_covariance</span>

    <span class="k">def</span> <span class="nf">save_exp_central_covariance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save the experimental central values and the covriance to a pickle</span>
<span class="sd">        file.</span>

<span class="sd">        The central values and the covariance must have been computed before</span>
<span class="sd">        using `get_exp_central_covariance`.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exp_central_covariance</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Call get_exp_central_covariance or make_measurement first.&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">central</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_exp_central_covariance</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">covariance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_exp_central_covariance</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">observables</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_exp_central_covariance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the experimental central values and the covriance from a pickle</span>
<span class="sd">        file.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_exp_central_covariance_dict</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_exp_central_covariance_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the the experimental central values and the covriancee from a</span>
<span class="sd">        dictionary.</span>

<span class="sd">        It must have the form</span>
<span class="sd">        {&#39;observables&#39;: [...], &#39;central&#39;: [...], &#39;covariance&#39;: [[...]]}</span>
<span class="sd">        where &#39;central&#39; is a vector of central values and &#39;covariance&#39; is a</span>
<span class="sd">        covariance matrix, both in the basis of observables given by</span>
<span class="sd">        &#39;observables&#39; which must at least contain all the observables</span>
<span class="sd">        involved in the fit. Additional observables will be ignored; the</span>
<span class="sd">        ordering is arbitrary.&quot;&quot;&quot;</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;observables&#39;</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">permutation</span> <span class="o">=</span> <span class="p">[</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Covariance matrix does not contain all necessary entries&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">permutation</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">),</span> \
            <span class="s2">&quot;Covariance matrix does not contain all necessary entries&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">permutation</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_exp_central_covariance</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;central&#39;</span><span class="p">],</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_exp_central_covariance</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;central&#39;</span><span class="p">][</span><span class="n">permutation</span><span class="p">],</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">][</span><span class="n">permutation</span><span class="p">][:,</span><span class="n">permutation</span><span class="p">],</span>
            <span class="p">)</span>

    <span class="c1"># a method to get the covariance of the SM prediction of all observables</span>
    <span class="c1"># of interest</span>
    <span class="k">def</span> <span class="nf">_get_random_nuisance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_random</span><span class="p">(</span><span class="n">par</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">nuisance</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">wc</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_covariance_sm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">threads</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">X_map</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_random_nuisance</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
            <span class="n">pred_map</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_predictions_array_sm</span><span class="p">,</span> <span class="n">X_map</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pool</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="n">threads</span><span class="p">)</span>
            <span class="n">X_map</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_random_nuisance</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
            <span class="n">pred_map</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_predictions_array_sm</span><span class="p">,</span> <span class="n">X_map</span><span class="p">)</span>
            <span class="n">pool</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">pool</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="n">pred_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pred_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pred_map</span><span class="p">):</span>
            <span class="n">pred_arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">pred_i</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">pred_arr</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_sm_covariance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the covriance matrix of the SM predictions of all observables</span>
<span class="sd">        under variation of all nuisance parameters.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        - `N`: number of random computations (computing time is proportional</span>
<span class="sd">          to it; more means less random fluctuations.)</span>
<span class="sd">        - `threads`: optional; number of parallel threads. Defaults to 1 (no</span>
<span class="sd">          parallelization)</span>
<span class="sd">        - `force`: optional; if True (default), will recompute covariance even</span>
<span class="sd">          if it already has been computed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sm_covariance</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sm_covariance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_covariance_sm</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">N</span> <span class="o">!=</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Argument N={} ignored &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> \
                          <span class="s2">&quot;as SM covariance has already &quot;</span> <span class="o">+</span> \
                          <span class="s2">&quot;been computed. Recompute with get_sm_covariance.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sm_covariance</span>

    <span class="k">def</span> <span class="nf">save_sm_covariance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save the SM covariance to a pickle file.</span>

<span class="sd">        The covariance must have been computed before using</span>
<span class="sd">        `get_sm_covariance`.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sm_covariance</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Call get_sm_covariance or make_measurement first.&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">covariance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sm_covariance</span><span class="p">,</span>
                        <span class="n">observables</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_sm_covariance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the SM covariance from a pickle file.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_sm_covariance_dict</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_sm_covariance_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the SM covariance from a dictionary.</span>

<span class="sd">        It must have the form {&#39;observables&#39;: [...], &#39;covariance&#39;: [[...]]}</span>
<span class="sd">        where &#39;covariance&#39; is a covariance matrix in the basis of observables</span>
<span class="sd">        given by &#39;observables&#39; which must at least contain all the observables</span>
<span class="sd">        involved in the fit. Additional observables will be ignored; the</span>
<span class="sd">        ordering is arbitrary.&quot;&quot;&quot;</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;observables&#39;</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">permutation</span> <span class="o">=</span> <span class="p">[</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Covariance matrix does not contain all necessary entries&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">permutation</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">),</span> \
            <span class="s2">&quot;Covariance matrix does not contain all necessary entries&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">permutation</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sm_covariance</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sm_covariance</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">][</span><span class="n">permutation</span><span class="p">][:,</span><span class="n">permutation</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sm_covariance</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">][</span><span class="n">permutation</span><span class="p">][:,</span><span class="n">permutation</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">make_measurement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Nexp</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">force_exp</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the fit by producing a pseudo-measurement containing both</span>
<span class="sd">        experimental uncertainties as well as theory uncertainties stemming</span>
<span class="sd">        from nuisance parameters.</span>

<span class="sd">        Optional parameters:</span>

<span class="sd">        - `N`: number of random computations for the SM covariance (computing</span>
<span class="sd">          time is proportional to it; more means less random fluctuations.)</span>
<span class="sd">        - `Nexp`: number of random computations for the experimental covariance.</span>
<span class="sd">          This is much less expensive than the theory covariance, so a large</span>
<span class="sd">          number can be afforded (default: 5000).</span>
<span class="sd">        - `threads`: number of parallel threads for the SM</span>
<span class="sd">          covariance computation. Defaults to 1 (no parallelization).</span>
<span class="sd">        - `force`: if True, will recompute SM covariance even if it</span>
<span class="sd">          already has been computed. Defaults to False.</span>
<span class="sd">        - `force_exp`: if True, will recompute experimental central values and</span>
<span class="sd">          covariance even if they have already been computed. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">central_exp</span><span class="p">,</span> <span class="n">cov_exp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_exp_central_covariance</span><span class="p">(</span><span class="n">Nexp</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force_exp</span><span class="p">)</span>
        <span class="n">cov_sm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sm_covariance</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span>
        <span class="n">covariance</span> <span class="o">=</span> <span class="n">cov_exp</span> <span class="o">+</span> <span class="n">cov_sm</span>
        <span class="c1"># add the Pseudo-measurement</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Measurement</span><span class="p">(</span><span class="s1">&#39;Pseudo-measurement for FastFit instance: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">central_exp</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">central_exp</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># for a 1D (or 0D) array</span>
            <span class="n">m</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">,</span>
                    <span class="n">NormalDistribution</span><span class="p">(</span><span class="n">central_exp</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">covariance</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">,</span>
                    <span class="n">MultivariateNormalDistribution</span><span class="p">(</span><span class="n">central_exp</span><span class="p">,</span> <span class="n">covariance</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">shortarray_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a 1D numpy array of floats to a dictionary of fit parameters</span>
<span class="sd">        and Wilson coefficients.&quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">n_fit_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span>
        <span class="n">n_wc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">p</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span> <span class="p">}</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_wc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">p</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">n_fit_p</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span> <span class="p">}</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="k">def</span> <span class="nf">dict_to_shortarray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a dictionary of fit parameters and Wilson coefficients to a</span>
<span class="sd">        1D numpy array of floats.&quot;&quot;&quot;</span>
        <span class="n">n_fit_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span>
        <span class="n">n_wc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_fit_p</span> <span class="o">+</span> <span class="n">n_nui_p</span> <span class="o">+</span> <span class="n">n_wc</span><span class="p">)</span>
        <span class="n">arr</span><span class="p">[:</span><span class="n">n_fit_p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_parameters&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">]</span>
        <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="p">:]</span>   <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_wc&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">arr</span>

    <span class="k">def</span> <span class="nf">shortarray_to_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert an array of fit parameters and Wilson coefficients to an</span>
<span class="sd">        array of fit parameters, nuisance parameters, and Wilson coefficients</span>
<span class="sd">        (setting nuisance parameters to their central values).&quot;&quot;&quot;</span>
        <span class="n">n_fit_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span>
        <span class="n">n_nui_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span>
        <span class="n">n_wc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_fit_p</span> <span class="o">+</span> <span class="n">n_nui_p</span> <span class="o">+</span> <span class="n">n_wc</span><span class="p">)</span>
        <span class="n">arr</span><span class="p">[:</span><span class="n">n_fit_p</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:</span><span class="n">n_fit_p</span><span class="p">]</span>
        <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="p">:</span><span class="n">n_fit_p</span><span class="o">+</span><span class="n">n_nui_p</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_central_nuisance_parameters</span>
        <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="o">+</span><span class="n">n_nui_p</span><span class="p">:]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">n_fit_p</span><span class="p">:]</span>
        <span class="k">return</span> <span class="n">arr</span>

    <span class="k">def</span> <span class="nf">log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the logarithm of the likelihood. Note that there is no prior</span>
<span class="sd">        probability for nuisance parameters, which have been integrated out.</span>
<span class="sd">        Priors for fit parameters are ignored.&quot;&quot;&quot;</span>
         <span class="c1"># set nuisance parameters to their central values!</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_predictions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shortarray_to_array</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">nuisance</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">m_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">Measurement</span><span class="p">[</span><span class="s1">&#39;Pseudo-measurement for FastFit instance: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="n">m_obs</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span>
        <span class="n">prob_dict</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">prob_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">ll</span>

    <span class="k">def</span> <span class="nf">best_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compute the best fit point in the space of fit parameters and Wilson</span>
<span class="sd">        coefficients.</span>

<span class="sd">        Keyword arguments will be passed to `scipy.optimize.minimize_scalar` in</span>
<span class="sd">        the case of a single fit variable and to `flavio.math.optimize.minimize_robust`</span>
<span class="sd">        in the case of multiple fit variables.</span>

<span class="sd">        Returns a dictionary with the following keys:</span>

<span class="sd">        - &#39;x&#39;: position of the best fit point</span>
<span class="sd">        - &#39;log_likelihood&#39;: logarithm of the likelihood at the best fit point</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n_fit_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span>
        <span class="n">n_wc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n_fit_p</span> <span class="o">+</span> <span class="n">n_wc</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">([</span><span class="n">x</span><span class="p">])</span>
            <span class="n">opt</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">minimize_scalar</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;x0&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_fit_p</span> <span class="o">+</span> <span class="n">n_wc</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">n_fit_p</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">x0</span><span class="p">[:</span><span class="n">n_fit_p</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_central_fit_parameters</span>
                <span class="n">opt</span> <span class="o">=</span> <span class="n">minimize_robust</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">opt</span> <span class="o">=</span> <span class="n">minimize_robust</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">opt</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Optimization failed.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">opt</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;log_likelihood&#39;</span><span class="p">:</span> <span class="o">-</span><span class="n">opt</span><span class="o">.</span><span class="n">fun</span><span class="p">}</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#flavio.statistics.fits.FastFit">FastFit</a></li>
          <li><a href="#flavio.statistics.fits.Fit">Fit</a></li>
          <li>flavio.classes.NamedInstanceClass</li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FastFit.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, *args, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialize self.  See help(type(self)) for accurate signature.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FastFit.__init__', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FastFit.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">measurements</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sm_covariance</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_exp_central_covariance</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_get_predictions_array_sm</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_predictions_array</span><span class="p">,</span>
                                             <span class="n">par</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">nuisance</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                             <span class="n">wc</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FastFit.array_to_dict">
    <p>def <span class="ident">array_to_dict</span>(</p><p>self, x)</p>
    </div>
    

    
  
    <div class="desc"><p>Convert a 1D numpy array of floats to a dictionary of fit parameters,
nuisance parameters, and Wilson coefficients.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FastFit.array_to_dict', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FastFit.array_to_dict" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">array_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a 1D numpy array of floats to a dictionary of fit parameters,</span>
<span class="sd">    nuisance parameters, and Wilson coefficients.&quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">n_fit_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span>
    <span class="n">n_nui_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span>
    <span class="n">n_wc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">p</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;nuisance_parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">p</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">n_fit_p</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_wc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">p</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">n_fit_p</span> <span class="o">+</span> <span class="n">n_nui_p</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span> <span class="p">}</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FastFit.best_fit">
    <p>def <span class="ident">best_fit</span>(</p><p>self, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Compute the best fit point in the space of fit parameters and Wilson
coefficients.</p>
<p>Keyword arguments will be passed to <code>scipy.optimize.minimize_scalar</code> in
the case of a single fit variable and to <code>flavio.math.optimize.minimize_robust</code>
in the case of multiple fit variables.</p>
<p>Returns a dictionary with the following keys:</p>
<ul>
<li>'x': position of the best fit point</li>
<li>'log_likelihood': logarithm of the likelihood at the best fit point</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FastFit.best_fit', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FastFit.best_fit" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">best_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compute the best fit point in the space of fit parameters and Wilson</span>
<span class="sd">    coefficients.</span>
<span class="sd">    Keyword arguments will be passed to `scipy.optimize.minimize_scalar` in</span>
<span class="sd">    the case of a single fit variable and to `flavio.math.optimize.minimize_robust`</span>
<span class="sd">    in the case of multiple fit variables.</span>
<span class="sd">    Returns a dictionary with the following keys:</span>
<span class="sd">    - &#39;x&#39;: position of the best fit point</span>
<span class="sd">    - &#39;log_likelihood&#39;: logarithm of the likelihood at the best fit point</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_fit_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span>
    <span class="n">n_wc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n_fit_p</span> <span class="o">+</span> <span class="n">n_wc</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">([</span><span class="n">x</span><span class="p">])</span>
        <span class="n">opt</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">minimize_scalar</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;x0&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_fit_p</span> <span class="o">+</span> <span class="n">n_wc</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">n_fit_p</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">x0</span><span class="p">[:</span><span class="n">n_fit_p</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_central_fit_parameters</span>
            <span class="n">opt</span> <span class="o">=</span> <span class="n">minimize_robust</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">opt</span> <span class="o">=</span> <span class="n">minimize_robust</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">opt</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Optimization failed.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">opt</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;log_likelihood&#39;</span><span class="p">:</span> <span class="o">-</span><span class="n">opt</span><span class="o">.</span><span class="n">fun</span><span class="p">}</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FastFit.dict_to_array">
    <p>def <span class="ident">dict_to_array</span>(</p><p>self, d)</p>
    </div>
    

    
  
    <div class="desc"><p>Convert a dictionary of fit parameters,
nuisance parameters, and Wilson coefficients to a 1D numpy array of
floats.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FastFit.dict_to_array', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FastFit.dict_to_array" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">dict_to_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a dictionary of fit parameters,</span>
<span class="sd">    nuisance parameters, and Wilson coefficients to a 1D numpy array of</span>
<span class="sd">    floats.&quot;&quot;&quot;</span>
    <span class="n">n_fit_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span>
    <span class="n">n_nui_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span>
    <span class="n">n_wc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_fit_p</span> <span class="o">+</span> <span class="n">n_nui_p</span> <span class="o">+</span> <span class="n">n_wc</span><span class="p">)</span>
    <span class="n">arr</span><span class="p">[:</span><span class="n">n_fit_p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_parameters&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">]</span>
    <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="p">:</span><span class="n">n_fit_p</span><span class="o">+</span><span class="n">n_nui_p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;nuisance_parameters&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">]</span>
    <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="o">+</span><span class="n">n_nui_p</span><span class="p">:]</span>   <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_wc&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">arr</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FastFit.dict_to_shortarray">
    <p>def <span class="ident">dict_to_shortarray</span>(</p><p>self, d)</p>
    </div>
    

    
  
    <div class="desc"><p>Convert a dictionary of fit parameters and Wilson coefficients to a
1D numpy array of floats.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FastFit.dict_to_shortarray', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FastFit.dict_to_shortarray" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">dict_to_shortarray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a dictionary of fit parameters and Wilson coefficients to a</span>
<span class="sd">    1D numpy array of floats.&quot;&quot;&quot;</span>
    <span class="n">n_fit_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span>
    <span class="n">n_wc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_fit_p</span> <span class="o">+</span> <span class="n">n_nui_p</span> <span class="o">+</span> <span class="n">n_wc</span><span class="p">)</span>
    <span class="n">arr</span><span class="p">[:</span><span class="n">n_fit_p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_parameters&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">]</span>
    <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="p">:]</span>   <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_wc&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">arr</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FastFit.get_exp_central_covariance">
    <p>def <span class="ident">get_exp_central_covariance</span>(</p><p>self, N=5000, force=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Return the experimental central values and the covriance matrix of
all observables.</p>
<p>Parameters:</p>
<ul>
<li><code>N</code>: number of random computations (computing time is proportional
  to it; more means less random fluctuations.)</li>
<li><code>force</code>: optional; if True (default), will recompute covariance even
  if it already has been computed.</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FastFit.get_exp_central_covariance', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FastFit.get_exp_central_covariance" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_exp_central_covariance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the experimental central values and the covriance matrix of</span>
<span class="sd">    all observables.</span>
<span class="sd">    Parameters:</span>
<span class="sd">    - `N`: number of random computations (computing time is proportional</span>
<span class="sd">      to it; more means less random fluctuations.)</span>
<span class="sd">    - `force`: optional; if True (default), will recompute covariance even</span>
<span class="sd">      if it already has been computed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exp_central_covariance</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_exp_central_covariance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_central_covariance_experiment</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">N</span> <span class="o">!=</span> <span class="mi">5000</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Argument N={} ignored &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> \
                      <span class="s2">&quot;as experimental covariance has already been &quot;</span> <span class="o">+</span> \
                      <span class="s2">&quot;computed. Recompute with get_exp_central_covariance.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exp_central_covariance</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FastFit.get_par_dict">
    <p>def <span class="ident">get_par_dict</span>(</p><p>self, x, par=True, nuisance=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Get a dictionary of fit and nuisance parameters from an input array</p>
<p>If par is False, fit parameters are set to their central values.
If nuisance is False, nuisance parameters are set to their central values.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FastFit.get_par_dict', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FastFit.get_par_dict" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_par_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">par</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nuisance</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get a dictionary of fit and nuisance parameters from an input array</span>
<span class="sd">    If par is False, fit parameters are set to their central values.</span>
<span class="sd">    If nuisance is False, nuisance parameters are set to their central values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array_to_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">par_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters_central</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">par</span><span class="p">:</span>
        <span class="n">par_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_parameters&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">nuisance</span><span class="p">:</span>
        <span class="n">par_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;nuisance_parameters&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">par_dict</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FastFit.get_predictions">
    <p>def <span class="ident">get_predictions</span>(</p><p>self, x, par=True, nuisance=True, wc=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Get a dictionary with predictions for all observables given an input
array.</p>
<p>If par is False, fit parameters are set to their central values.
If nuisance is False, nuisance parameters are set to their central values.
If wc is False, Wilson coefficients are set to their SM values.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FastFit.get_predictions', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FastFit.get_predictions" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">par</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nuisance</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">wc</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get a dictionary with predictions for all observables given an input</span>
<span class="sd">    array.</span>
<span class="sd">    If par is False, fit parameters are set to their central values.</span>
<span class="sd">    If nuisance is False, nuisance parameters are set to their central values.</span>
<span class="sd">    If wc is False, Wilson coefficients are set to their SM values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">par_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_par_dict</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">par</span><span class="o">=</span><span class="n">par</span><span class="p">,</span> <span class="n">nuisance</span><span class="o">=</span><span class="n">nuisance</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wc</span><span class="p">:</span>
        <span class="n">wc_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wc_obj</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">wc_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">physics</span><span class="o">.</span><span class="n">eft</span><span class="o">.</span><span class="n">_wc_sm</span>
    <span class="n">all_predictions</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">observable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">observable</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">obs_name</span> <span class="o">=</span> <span class="n">observable</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">_inst</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="p">[</span><span class="n">obs_name</span><span class="p">]</span>
            <span class="n">all_predictions</span><span class="p">[</span><span class="n">observable</span><span class="p">]</span> <span class="o">=</span> <span class="n">_inst</span><span class="o">.</span><span class="n">prediction_par</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="o">*</span><span class="n">observable</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_inst</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="p">[</span><span class="n">observable</span><span class="p">]</span>
            <span class="n">all_predictions</span><span class="p">[</span><span class="n">observable</span><span class="p">]</span> <span class="o">=</span> <span class="n">_inst</span><span class="o">.</span><span class="n">prediction_par</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">all_predictions</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FastFit.get_predictions_array">
    <p>def <span class="ident">get_predictions_array</span>(</p><p>self, x, **kwargs)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FastFit.get_predictions_array', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FastFit.get_predictions_array" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_predictions_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_predictions</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pred</span><span class="p">[</span><span class="n">obs</span><span class="p">]</span> <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FastFit.get_sm_covariance">
    <p>def <span class="ident">get_sm_covariance</span>(</p><p>self, N=100, threads=1, force=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Return the covriance matrix of the SM predictions of all observables
under variation of all nuisance parameters.</p>
<p>Parameters:</p>
<ul>
<li><code>N</code>: number of random computations (computing time is proportional
  to it; more means less random fluctuations.)</li>
<li><code>threads</code>: optional; number of parallel threads. Defaults to 1 (no
  parallelization)</li>
<li><code>force</code>: optional; if True (default), will recompute covariance even
  if it already has been computed.</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FastFit.get_sm_covariance', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FastFit.get_sm_covariance" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_sm_covariance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the covriance matrix of the SM predictions of all observables</span>
<span class="sd">    under variation of all nuisance parameters.</span>
<span class="sd">    Parameters:</span>
<span class="sd">    - `N`: number of random computations (computing time is proportional</span>
<span class="sd">      to it; more means less random fluctuations.)</span>
<span class="sd">    - `threads`: optional; number of parallel threads. Defaults to 1 (no</span>
<span class="sd">      parallelization)</span>
<span class="sd">    - `force`: optional; if True (default), will recompute covariance even</span>
<span class="sd">      if it already has been computed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sm_covariance</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sm_covariance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_covariance_sm</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">N</span> <span class="o">!=</span> <span class="mi">100</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Argument N={} ignored &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> \
                      <span class="s2">&quot;as SM covariance has already &quot;</span> <span class="o">+</span> \
                      <span class="s2">&quot;been computed. Recompute with get_sm_covariance.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sm_covariance</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FastFit.get_wc_obj">
    <p>def <span class="ident">get_wc_obj</span>(</p><p>self, x)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FastFit.get_wc_obj', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FastFit.get_wc_obj" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_wc_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="n">wc_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">WilsonCoefficients</span><span class="p">()</span>
    <span class="c1"># if there are no WCs to be fitted, return the SM WCs</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">wc_obj</span>
    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array_to_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">wc_obj</span><span class="o">.</span><span class="n">set_initial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_function</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_wc&#39;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_scale</span><span class="p">,</span>
                       <span class="n">eft</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eft</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">basis</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wc_obj</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FastFit.load_exp_central_covariance">
    <p>def <span class="ident">load_exp_central_covariance</span>(</p><p>self, filename)</p>
    </div>
    

    
  
    <div class="desc"><p>Load the experimental central values and the covriance from a pickle
file.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FastFit.load_exp_central_covariance', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FastFit.load_exp_central_covariance" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">load_exp_central_covariance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Load the experimental central values and the covriance from a pickle</span>
<span class="sd">    file.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_exp_central_covariance_dict</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FastFit.load_exp_central_covariance_dict">
    <p>def <span class="ident">load_exp_central_covariance_dict</span>(</p><p>self, d)</p>
    </div>
    

    
  
    <div class="desc"><p>Load the the experimental central values and the covriancee from a
dictionary.</p>
<p>It must have the form
{'observables': [...], 'central': [...], 'covariance': [[...]]}
where 'central' is a vector of central values and 'covariance' is a
covariance matrix, both in the basis of observables given by
'observables' which must at least contain all the observables
involved in the fit. Additional observables will be ignored; the
ordering is arbitrary.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FastFit.load_exp_central_covariance_dict', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FastFit.load_exp_central_covariance_dict" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">load_exp_central_covariance_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Load the the experimental central values and the covriancee from a</span>
<span class="sd">    dictionary.</span>
<span class="sd">    It must have the form</span>
<span class="sd">    {&#39;observables&#39;: [...], &#39;central&#39;: [...], &#39;covariance&#39;: [[...]]}</span>
<span class="sd">    where &#39;central&#39; is a vector of central values and &#39;covariance&#39; is a</span>
<span class="sd">    covariance matrix, both in the basis of observables given by</span>
<span class="sd">    &#39;observables&#39; which must at least contain all the observables</span>
<span class="sd">    involved in the fit. Additional observables will be ignored; the</span>
<span class="sd">    ordering is arbitrary.&quot;&quot;&quot;</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;observables&#39;</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">permutation</span> <span class="o">=</span> <span class="p">[</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Covariance matrix does not contain all necessary entries&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">permutation</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">),</span> \
        <span class="s2">&quot;Covariance matrix does not contain all necessary entries&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">permutation</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_exp_central_covariance</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;central&#39;</span><span class="p">],</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_exp_central_covariance</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;central&#39;</span><span class="p">][</span><span class="n">permutation</span><span class="p">],</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">][</span><span class="n">permutation</span><span class="p">][:,</span><span class="n">permutation</span><span class="p">],</span>
        <span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FastFit.load_sm_covariance">
    <p>def <span class="ident">load_sm_covariance</span>(</p><p>self, filename)</p>
    </div>
    

    
  
    <div class="desc"><p>Load the SM covariance from a pickle file.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FastFit.load_sm_covariance', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FastFit.load_sm_covariance" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">load_sm_covariance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Load the SM covariance from a pickle file.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_sm_covariance_dict</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FastFit.load_sm_covariance_dict">
    <p>def <span class="ident">load_sm_covariance_dict</span>(</p><p>self, d)</p>
    </div>
    

    
  
    <div class="desc"><p>Load the SM covariance from a dictionary.</p>
<p>It must have the form {'observables': [...], 'covariance': [[...]]}
where 'covariance' is a covariance matrix in the basis of observables
given by 'observables' which must at least contain all the observables
involved in the fit. Additional observables will be ignored; the
ordering is arbitrary.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FastFit.load_sm_covariance_dict', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FastFit.load_sm_covariance_dict" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">load_sm_covariance_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Load the SM covariance from a dictionary.</span>
<span class="sd">    It must have the form {&#39;observables&#39;: [...], &#39;covariance&#39;: [[...]]}</span>
<span class="sd">    where &#39;covariance&#39; is a covariance matrix in the basis of observables</span>
<span class="sd">    given by &#39;observables&#39; which must at least contain all the observables</span>
<span class="sd">    involved in the fit. Additional observables will be ignored; the</span>
<span class="sd">    ordering is arbitrary.&quot;&quot;&quot;</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;observables&#39;</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">permutation</span> <span class="o">=</span> <span class="p">[</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Covariance matrix does not contain all necessary entries&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">permutation</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">),</span> \
        <span class="s2">&quot;Covariance matrix does not contain all necessary entries&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">permutation</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sm_covariance</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sm_covariance</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">][</span><span class="n">permutation</span><span class="p">][:,</span><span class="n">permutation</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sm_covariance</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">][</span><span class="n">permutation</span><span class="p">][:,</span><span class="n">permutation</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FastFit.log_likelihood">
    <p>def <span class="ident">log_likelihood</span>(</p><p>self, x)</p>
    </div>
    

    
  
    <div class="desc"><p>Return the logarithm of the likelihood. Note that there is no prior
probability for nuisance parameters, which have been integrated out.
Priors for fit parameters are ignored.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FastFit.log_likelihood', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FastFit.log_likelihood" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the logarithm of the likelihood. Note that there is no prior</span>
<span class="sd">    probability for nuisance parameters, which have been integrated out.</span>
<span class="sd">    Priors for fit parameters are ignored.&quot;&quot;&quot;</span>
     <span class="c1"># set nuisance parameters to their central values!</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_predictions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shortarray_to_array</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">nuisance</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">m_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">Measurement</span><span class="p">[</span><span class="s1">&#39;Pseudo-measurement for FastFit instance: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
    <span class="n">m_obs</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span>
    <span class="n">prob_dict</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">prob_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">ll</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FastFit.log_likelihood_exp">
    <p>def <span class="ident">log_likelihood_exp</span>(</p><p>self, x)</p>
    </div>
    

    
  
    <div class="desc"><p>Return the logarithm of the likelihood function (not including the
prior)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FastFit.log_likelihood_exp', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FastFit.log_likelihood_exp" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">log_likelihood_exp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the logarithm of the likelihood function (not including the</span>
<span class="sd">    prior)&quot;&quot;&quot;</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_predictions</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">for</span> <span class="n">measurement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_measurements</span><span class="p">:</span>
        <span class="n">m_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">Measurement</span><span class="p">[</span><span class="n">measurement</span><span class="p">]</span>
        <span class="n">m_obs</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span>
        <span class="n">exclude_observables</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">m_obs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span>
        <span class="n">prob_dict</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">exclude_parameters</span><span class="o">=</span><span class="n">exclude_observables</span><span class="p">)</span>
        <span class="n">ll</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">prob_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">ll</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FastFit.log_prior_nuisance_parameters">
    <p>def <span class="ident">log_prior_nuisance_parameters</span>(</p><p>self, x)</p>
    </div>
    

    
  
    <div class="desc"><p>Return the prior probability (or frequentist likelihood) for all
nuisance parameters given an input array</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FastFit.log_prior_nuisance_parameters', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FastFit.log_prior_nuisance_parameters" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">log_prior_nuisance_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the prior probability (or frequentist likelihood) for all</span>
<span class="sd">    nuisance parameters given an input array&quot;&quot;&quot;</span>
    <span class="n">par_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_par_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">exclude_parameters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">par_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">))</span>
    <span class="n">prob_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">exclude_parameters</span><span class="o">=</span><span class="n">exclude_parameters</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prob_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FastFit.log_prior_parameters">
    <p>def <span class="ident">log_prior_parameters</span>(</p><p>self, x)</p>
    </div>
    

    
  
    <div class="desc"><p>Return the prior probability (or frequentist likelihood) for all
fit and (!) nuisance parameters given an input array</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FastFit.log_prior_parameters', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FastFit.log_prior_parameters" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">log_prior_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the prior probability (or frequentist likelihood) for all</span>
<span class="sd">    fit and (!) nuisance parameters given an input array&quot;&quot;&quot;</span>
    <span class="n">par_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_par_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">exclude_parameters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">par_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">))</span>
    <span class="n">prob_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">exclude_parameters</span><span class="o">=</span><span class="n">exclude_parameters</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prob_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FastFit.log_prior_wilson_coeffs">
    <p>def <span class="ident">log_prior_wilson_coeffs</span>(</p><p>self, x)</p>
    </div>
    

    
  
    <div class="desc"><p>Return the prior probability for all Wilson coefficients
given an input array</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FastFit.log_prior_wilson_coeffs', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FastFit.log_prior_wilson_coeffs" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">log_prior_wilson_coeffs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the prior probability for all Wilson coefficients</span>
<span class="sd">    given an input array&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_priors</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="n">wc_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array_to_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="s1">&#39;fit_wc&#39;</span><span class="p">]</span>
    <span class="n">prob_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_priors</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">wc_dict</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prob_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FastFit.make_measurement">
    <p>def <span class="ident">make_measurement</span>(</p><p>self, N=100, Nexp=5000, threads=1, force=False, force_exp=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialize the fit by producing a pseudo-measurement containing both
experimental uncertainties as well as theory uncertainties stemming
from nuisance parameters.</p>
<p>Optional parameters:</p>
<ul>
<li><code>N</code>: number of random computations for the SM covariance (computing
  time is proportional to it; more means less random fluctuations.)</li>
<li><code>Nexp</code>: number of random computations for the experimental covariance.
  This is much less expensive than the theory covariance, so a large
  number can be afforded (default: 5000).</li>
<li><code>threads</code>: number of parallel threads for the SM
  covariance computation. Defaults to 1 (no parallelization).</li>
<li><code>force</code>: if True, will recompute SM covariance even if it
  already has been computed. Defaults to False.</li>
<li><code>force_exp</code>: if True, will recompute experimental central values and
  covariance even if they have already been computed. Defaults to False.</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FastFit.make_measurement', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FastFit.make_measurement" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">make_measurement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Nexp</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">force_exp</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initialize the fit by producing a pseudo-measurement containing both</span>
<span class="sd">    experimental uncertainties as well as theory uncertainties stemming</span>
<span class="sd">    from nuisance parameters.</span>
<span class="sd">    Optional parameters:</span>
<span class="sd">    - `N`: number of random computations for the SM covariance (computing</span>
<span class="sd">      time is proportional to it; more means less random fluctuations.)</span>
<span class="sd">    - `Nexp`: number of random computations for the experimental covariance.</span>
<span class="sd">      This is much less expensive than the theory covariance, so a large</span>
<span class="sd">      number can be afforded (default: 5000).</span>
<span class="sd">    - `threads`: number of parallel threads for the SM</span>
<span class="sd">      covariance computation. Defaults to 1 (no parallelization).</span>
<span class="sd">    - `force`: if True, will recompute SM covariance even if it</span>
<span class="sd">      already has been computed. Defaults to False.</span>
<span class="sd">    - `force_exp`: if True, will recompute experimental central values and</span>
<span class="sd">      covariance even if they have already been computed. Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">central_exp</span><span class="p">,</span> <span class="n">cov_exp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_exp_central_covariance</span><span class="p">(</span><span class="n">Nexp</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force_exp</span><span class="p">)</span>
    <span class="n">cov_sm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sm_covariance</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span>
    <span class="n">covariance</span> <span class="o">=</span> <span class="n">cov_exp</span> <span class="o">+</span> <span class="n">cov_sm</span>
    <span class="c1"># add the Pseudo-measurement</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Measurement</span><span class="p">(</span><span class="s1">&#39;Pseudo-measurement for FastFit instance: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">central_exp</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">central_exp</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># for a 1D (or 0D) array</span>
        <span class="n">m</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">,</span>
                <span class="n">NormalDistribution</span><span class="p">(</span><span class="n">central_exp</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">covariance</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">m</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">,</span>
                <span class="n">MultivariateNormalDistribution</span><span class="p">(</span><span class="n">central_exp</span><span class="p">,</span> <span class="n">covariance</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FastFit.save_exp_central_covariance">
    <p>def <span class="ident">save_exp_central_covariance</span>(</p><p>self, filename)</p>
    </div>
    

    
  
    <div class="desc"><p>Save the experimental central values and the covriance to a pickle
file.</p>
<p>The central values and the covariance must have been computed before
using <code>get_exp_central_covariance</code>.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FastFit.save_exp_central_covariance', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FastFit.save_exp_central_covariance" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save_exp_central_covariance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Save the experimental central values and the covriance to a pickle</span>
<span class="sd">    file.</span>
<span class="sd">    The central values and the covariance must have been computed before</span>
<span class="sd">    using `get_exp_central_covariance`.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exp_central_covariance</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Call get_exp_central_covariance or make_measurement first.&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">central</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_exp_central_covariance</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">covariance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_exp_central_covariance</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">observables</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FastFit.save_sm_covariance">
    <p>def <span class="ident">save_sm_covariance</span>(</p><p>self, filename)</p>
    </div>
    

    
  
    <div class="desc"><p>Save the SM covariance to a pickle file.</p>
<p>The covariance must have been computed before using
<code>get_sm_covariance</code>.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FastFit.save_sm_covariance', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FastFit.save_sm_covariance" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save_sm_covariance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Save the SM covariance to a pickle file.</span>
<span class="sd">    The covariance must have been computed before using</span>
<span class="sd">    `get_sm_covariance`.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sm_covariance</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Call get_sm_covariance or make_measurement first.&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">covariance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sm_covariance</span><span class="p">,</span>
                    <span class="n">observables</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FastFit.set_description">
    <p>def <span class="ident">set_description</span>(</p><p>self, description)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FastFit.set_description', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FastFit.set_description" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FastFit.shortarray_to_array">
    <p>def <span class="ident">shortarray_to_array</span>(</p><p>self, x)</p>
    </div>
    

    
  
    <div class="desc"><p>Convert an array of fit parameters and Wilson coefficients to an
array of fit parameters, nuisance parameters, and Wilson coefficients
(setting nuisance parameters to their central values).</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FastFit.shortarray_to_array', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FastFit.shortarray_to_array" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">shortarray_to_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert an array of fit parameters and Wilson coefficients to an</span>
<span class="sd">    array of fit parameters, nuisance parameters, and Wilson coefficients</span>
<span class="sd">    (setting nuisance parameters to their central values).&quot;&quot;&quot;</span>
    <span class="n">n_fit_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span>
    <span class="n">n_nui_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span>
    <span class="n">n_wc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_fit_p</span> <span class="o">+</span> <span class="n">n_nui_p</span> <span class="o">+</span> <span class="n">n_wc</span><span class="p">)</span>
    <span class="n">arr</span><span class="p">[:</span><span class="n">n_fit_p</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:</span><span class="n">n_fit_p</span><span class="p">]</span>
    <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="p">:</span><span class="n">n_fit_p</span><span class="o">+</span><span class="n">n_nui_p</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_central_nuisance_parameters</span>
    <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="o">+</span><span class="n">n_nui_p</span><span class="p">:]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">n_fit_p</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">arr</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FastFit.shortarray_to_dict">
    <p>def <span class="ident">shortarray_to_dict</span>(</p><p>self, x)</p>
    </div>
    

    
  
    <div class="desc"><p>Convert a 1D numpy array of floats to a dictionary of fit parameters
and Wilson coefficients.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FastFit.shortarray_to_dict', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FastFit.shortarray_to_dict" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">shortarray_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a 1D numpy array of floats to a dictionary of fit parameters</span>
<span class="sd">    and Wilson coefficients.&quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">n_fit_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span>
    <span class="n">n_wc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">p</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_wc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">p</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">n_fit_p</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span> <span class="p">}</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="flavio.statistics.fits.FastFit.get_central_fit_parameters" class="name">var <span class="ident">get_central_fit_parameters</span></p>
            

            
  
    <div class="desc"><p>Return a numpy array with the central values of all fit parameters.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.FastFit.get_central_nuisance_parameters" class="name">var <span class="ident">get_central_nuisance_parameters</span></p>
            

            
  
    <div class="desc"><p>Return a numpy array with the central values of all nuisance parameters.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.FastFit.get_measurements" class="name">var <span class="ident">get_measurements</span></p>
            

            
  
    <div class="desc"><p>Return a list of all the measurements currently defined that
constrain any of the fit observables.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.FastFit.get_random" class="name">var <span class="ident">get_random</span></p>
            

            
  
    <div class="desc"><p>Get an array with random values for all the fit and nuisance
parameters and Wilson coefficients.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.FastFit.get_random_fit_parameters" class="name">var <span class="ident">get_random_fit_parameters</span></p>
            

            
  
    <div class="desc"><p>Return a numpy array with random values for all fit parameters.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.FastFit.get_random_nuisance_parameters" class="name">var <span class="ident">get_random_nuisance_parameters</span></p>
            

            
  
    <div class="desc"><p>Return a numpy array with random values for all nuisance parameters.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.FastFit.get_random_start" class="name">var <span class="ident">get_random_start</span></p>
            

            
  
    <div class="desc"><p>Get an array with random values for all the fit and nuisance
parameters with Wilson coefficients set to their SM values</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.FastFit.get_random_wilson_coeffs" class="name">var <span class="ident">get_random_wilson_coeffs</span></p>
            

            
  
    <div class="desc"><p>Return a numpy array with random values for all Wilson coefficients.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.FastFit.get_random_wilson_coeffs_start" class="name">var <span class="ident">get_random_wilson_coeffs_start</span></p>
            

            
  
    <div class="desc"><p>Return a numpy array with random values for all Wilson coefficients
sampling the start_wc_priors distribution.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.FastFit.measurements" class="name">var <span class="ident">measurements</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FastFit.clear_all">
    <p>def <span class="ident">clear_all</span>(</p><p>cls)</p>
    </div>
    

    
  
    <div class="desc"><p>Delete all instances.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FastFit.clear_all', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FastFit.clear_all" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">clear_all</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Delete all instances.&quot;&quot;&quot;</span>
    <span class="bp">cls</span><span class="o">.</span><span class="n">instances</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FastFit.del_instance">
    <p>def <span class="ident">del_instance</span>(</p><p>cls, name)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FastFit.del_instance', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FastFit.del_instance" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">del_instance</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="k">del</span> <span class="bp">cls</span><span class="o">.</span><span class="n">instances</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FastFit.get_instance">
    <p>def <span class="ident">get_instance</span>(</p><p>cls, name)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FastFit.get_instance', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FastFit.get_instance" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">get_instance</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">instances</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="flavio.statistics.fits.Fit" class="name">class <span class="ident">Fit</span></p>
      
  
    <div class="desc"><p>Base class for fits. Not meant to be used directly.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.Fit', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.Fit" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Fit</span><span class="p">(</span><span class="n">flavio</span><span class="o">.</span><span class="n">NamedInstanceClass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for fits. Not meant to be used directly.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">name</span><span class="p">,</span>
                 <span class="n">par_obj</span><span class="o">=</span><span class="n">flavio</span><span class="o">.</span><span class="n">default_parameters</span><span class="p">,</span>
                 <span class="n">fit_parameters</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">nuisance_parameters</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">observables</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">fit_wc_names</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">fit_wc_function</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">fit_wc_priors</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">input_scale</span><span class="o">=</span><span class="mf">160.</span><span class="p">,</span>
                 <span class="n">exclude_measurements</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">include_measurements</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">fit_wc_eft</span><span class="o">=</span><span class="s1">&#39;WET&#39;</span><span class="p">,</span>
                 <span class="n">fit_wc_basis</span><span class="o">=</span><span class="s1">&#39;flavio&#39;</span><span class="p">,</span>
                <span class="p">):</span>
        <span class="k">if</span> <span class="n">fit_parameters</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span> <span class="o">=</span> <span class="n">fit_parameters</span>
        <span class="k">if</span> <span class="n">nuisance_parameters</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="n">nuisance_parameters</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span> <span class="o">=</span> <span class="n">par_obj</span><span class="o">.</span><span class="n">all_parameters</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span> <span class="o">=</span> <span class="n">nuisance_parameters</span>
        <span class="k">if</span> <span class="n">observables</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;observables&#39; is empty: you must specify at least one fit observable&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fit_wc_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;The &#39;fit_wc_names&#39; argument is no longer necessary &quot;</span>
            <span class="s2">&quot;as of flavio v0.19 and might be removed in the future.&quot;</span><span class="p">,</span>
            <span class="ne">FutureWarning</span><span class="p">)</span>
        <span class="c1"># some checks to make sure the input is sane</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">:</span>
            <span class="c1"># check that nuisance parameters are constrained</span>
            <span class="k">assert</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">par_obj</span><span class="o">.</span><span class="n">_parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="s2">&quot;Parameter &quot;</span> <span class="o">+</span> <span class="n">p</span> <span class="o">+</span> <span class="s2">&quot; not found in Constraints&quot;</span>
        <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">observables</span><span class="p">:</span>
            <span class="c1"># check that observables exist</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="p">[</span><span class="n">obs</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unexpected form of observable: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obs</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Observable &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; not found!&quot;</span><span class="p">)</span>
        <span class="n">_obs_measured</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">exclude_measurements</span> <span class="ow">and</span> <span class="n">include_measurements</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The options exclude_measurements and include_measurements must not be specified simultaneously&quot;</span><span class="p">)</span>
        <span class="c1"># check that no parameter appears as fit *and* nuisance parameter</span>
        <span class="n">intersect</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">intersect</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(),</span> <span class="s2">&quot;Parameters appearing as fit_parameters and nuisance_parameters: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">intersect</span><span class="p">)</span>
        <span class="c1"># check that the Wilson coefficient function works</span>
        <span class="k">if</span> <span class="n">fit_wc_function</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="c1"># if list of WC names not empty</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">fit_wc_function</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="n">fit_wc_function</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">fit_wc_name</span><span class="p">:</span> <span class="mf">1e-6</span> <span class="k">for</span> <span class="n">fit_wc_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">})</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Error in calling the Wilson coefficient function&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>
        <span class="c1"># now that everything seems fine, we can call the init of the parent class</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span> <span class="o">=</span> <span class="n">par_obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters_central</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_central_all</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exclude_measurements</span> <span class="o">=</span> <span class="n">exclude_measurements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">include_measurements</span> <span class="o">=</span> <span class="n">include_measurements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_function</span> <span class="o">=</span> <span class="n">fit_wc_function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_priors</span> <span class="o">=</span> <span class="n">fit_wc_priors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observables</span> <span class="o">=</span> <span class="n">observables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_scale</span> <span class="o">=</span> <span class="n">input_scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_warn_meas_corr</span>

        <span class="c1"># check that observables are constrained</span>
        <span class="k">for</span> <span class="n">m_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_measurements</span><span class="p">:</span>
            <span class="n">m_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">Measurement</span><span class="p">[</span><span class="n">m_name</span><span class="p">]</span>
            <span class="n">_obs_measured</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span><span class="p">)</span>
        <span class="n">missing_obs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">observables</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">_obs_measured</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">observables</span><span class="p">))</span>
        <span class="k">assert</span> <span class="n">missing_obs</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(),</span> <span class="s2">&quot;No measurement found for the observables: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">missing_obs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eft</span> <span class="o">=</span> <span class="n">fit_wc_eft</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="n">fit_wc_basis</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_central_fit_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a numpy array with the central values of all fit parameters.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters_central</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_random_fit_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a numpy array with random values for all fit parameters.&quot;&quot;&quot;</span>
        <span class="n">all_random</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_random_all</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">all_random</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_random_wilson_coeffs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a numpy array with random values for all Wilson coefficients.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_priors</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">all_random</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_priors</span><span class="o">.</span><span class="n">get_random_all</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">all_random</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_central_nuisance_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a numpy array with the central values of all nuisance parameters.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters_central</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_random_nuisance_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a numpy array with random values for all nuisance parameters.&quot;&quot;&quot;</span>
        <span class="n">all_random</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_random_all</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">all_random</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_measurements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of all the measurements currently defined that</span>
<span class="sd">        constrain any of the fit observables.&quot;&quot;&quot;</span>
        <span class="n">all_measurements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">m_name</span><span class="p">,</span> <span class="n">m_obj</span> <span class="ow">in</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Measurement</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">m_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Pseudo-measurement&#39;</span><span class="p">:</span>
                <span class="c1"># skip pseudo measurements generated by FastFit instances</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span><span class="p">)</span><span class="o">.</span><span class="n">isdisjoint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">):</span>
                <span class="c1"># if set of all observables constrained by measurement is disjoint</span>
                <span class="c1"># with fit observables, do nothing</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># else, add measurement name to output list</span>
                <span class="n">all_measurements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclude_measurements</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_measurements</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">all_measurements</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclude_measurements</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">all_measurements</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exclude_measurements</span><span class="p">))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_measurements</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">all_measurements</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">include_measurements</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_warn_meas_corr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Warn the user if the fit contains multiple correlated measurements of</span>
<span class="sd">        an observable that is not included in the fit parameters, as this will</span>
<span class="sd">        lead to inconsistent results.&quot;&quot;&quot;</span>
        <span class="n">corr_with</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># iterate over all measurements constraining at least one fit obs.</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_measurements</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Measurement</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="c1"># iterate over all fit obs. constrained by this measurement</span>
            <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">all_parameters</span><span class="p">):</span>
                <span class="c1"># the constraint on this fit obs.</span>
                <span class="n">constraint</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">_parameters</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="c1"># find all the other obs. constrained by this constraint</span>
                <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">_constraints</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">constraint</span><span class="p">:</span>
                        <span class="n">par</span> <span class="o">=</span> <span class="n">p</span>
                        <span class="k">break</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">par</span><span class="p">:</span>
                    <span class="c1"># if the other obs. are not fit obs., append them to the list</span>
                    <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">corr_with</span><span class="p">:</span>
                            <span class="n">corr_with</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">obs</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">corr_with</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="c1"># replace list by a Counter</span>
        <span class="n">corr_with</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">Counter</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">corr_with</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="p">}</span>
        <span class="c1"># warn for all counts &gt; 1</span>
        <span class="k">for</span> <span class="n">obs1</span><span class="p">,</span> <span class="n">counter</span> <span class="ow">in</span> <span class="n">corr_with</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">obs2</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">counter</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">((</span><span class="s2">&quot;{} of the measurements in the fit &#39;{}&#39; &quot;</span>
                                   <span class="s2">&quot;constrain both &#39;{}&#39; and &#39;{}&#39;, but only the &quot;</span>
                                   <span class="s2">&quot;latter is included among the fit &quot;</span>
                                   <span class="s2">&quot;observables. This can lead to inconsistent &quot;</span>
                                   <span class="s2">&quot;results as the former is profiled over.&quot;</span>
                                   <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">obs1</span><span class="p">,</span> <span class="n">obs2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">corr_with</span>


    <span class="k">def</span> <span class="nf">array_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a 1D numpy array of floats to a dictionary of fit parameters,</span>
<span class="sd">        nuisance parameters, and Wilson coefficients.&quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">n_fit_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span>
        <span class="n">n_nui_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span>
        <span class="n">n_wc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">p</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span> <span class="p">}</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;nuisance_parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">p</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">n_fit_p</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span> <span class="p">}</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_wc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">p</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">n_fit_p</span> <span class="o">+</span> <span class="n">n_nui_p</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span> <span class="p">}</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="k">def</span> <span class="nf">dict_to_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a dictionary of fit parameters,</span>
<span class="sd">        nuisance parameters, and Wilson coefficients to a 1D numpy array of</span>
<span class="sd">        floats.&quot;&quot;&quot;</span>
        <span class="n">n_fit_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span>
        <span class="n">n_nui_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span>
        <span class="n">n_wc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_fit_p</span> <span class="o">+</span> <span class="n">n_nui_p</span> <span class="o">+</span> <span class="n">n_wc</span><span class="p">)</span>
        <span class="n">arr</span><span class="p">[:</span><span class="n">n_fit_p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_parameters&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">]</span>
        <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="p">:</span><span class="n">n_fit_p</span><span class="o">+</span><span class="n">n_nui_p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;nuisance_parameters&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">]</span>
        <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="o">+</span><span class="n">n_nui_p</span><span class="p">:]</span>   <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_wc&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">arr</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_random</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get an array with random values for all the fit and nuisance</span>
<span class="sd">        parameters and Wilson coefficients.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_random</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_random</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">par</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nuisance</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">wc</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get an array with random values for all the fit and nuisance</span>
<span class="sd">        parameters and Wilson coefficients.</span>

<span class="sd">        If par is False, fit parameters are set to their central values.</span>
<span class="sd">        If nuisance is False, nuisance parameters are set to their central values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="p">)</span>
        <span class="n">n_fit_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span>
        <span class="n">n_nui_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">par</span><span class="p">:</span>
            <span class="n">arr</span><span class="p">[:</span><span class="n">n_fit_p</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_random_fit_parameters</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">arr</span><span class="p">[:</span><span class="n">n_fit_p</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_central_fit_parameters</span>
        <span class="k">if</span> <span class="n">nuisance</span><span class="p">:</span>
            <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="p">:</span><span class="n">n_fit_p</span><span class="o">+</span><span class="n">n_nui_p</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_random_nuisance_parameters</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="p">:</span><span class="n">n_fit_p</span><span class="o">+</span><span class="n">n_nui_p</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_central_nuisance_parameters</span>
        <span class="k">if</span> <span class="n">wc</span><span class="p">:</span>
            <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="o">+</span><span class="n">n_nui_p</span><span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_random_wilson_coeffs</span>
        <span class="k">return</span> <span class="n">arr</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_random_wilson_coeffs_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a numpy array with random values for all Wilson coefficients</span>
<span class="sd">        sampling the start_wc_priors distribution.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_function</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># no Wilson coefficients present</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_wc_priors</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_priors</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Starting values can only be generated if&quot;</span>
                        <span class="s2">&quot; either fit_wc_priors or start_wc_priors is defined&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_random_wilson_coeffs</span>
        <span class="n">all_random</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_wc_priors</span><span class="o">.</span><span class="n">get_random_all</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">all_random</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_random_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get an array with random values for all the fit and nuisance</span>
<span class="sd">        parameters with Wilson coefficients set to their SM values&quot;&quot;&quot;</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="p">)</span>
        <span class="n">n_fit_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span>
        <span class="n">n_nui_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span>
        <span class="n">arr</span><span class="p">[:</span><span class="n">n_fit_p</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_random_fit_parameters</span>
        <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="p">:</span><span class="n">n_fit_p</span><span class="o">+</span><span class="n">n_nui_p</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_random_nuisance_parameters</span>
        <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="o">+</span><span class="n">n_nui_p</span><span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_random_wilson_coeffs_start</span>
        <span class="k">return</span> <span class="n">arr</span>

    <span class="k">def</span> <span class="nf">get_par_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">par</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nuisance</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a dictionary of fit and nuisance parameters from an input array</span>

<span class="sd">        If par is False, fit parameters are set to their central values.</span>
<span class="sd">        If nuisance is False, nuisance parameters are set to their central values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array_to_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">par_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters_central</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">par</span><span class="p">:</span>
            <span class="n">par_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_parameters&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">nuisance</span><span class="p">:</span>
            <span class="n">par_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;nuisance_parameters&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">par_dict</span>

    <span class="k">def</span> <span class="nf">get_wc_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">wc_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">WilsonCoefficients</span><span class="p">()</span>
        <span class="c1"># if there are no WCs to be fitted, return the SM WCs</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">wc_obj</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array_to_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">wc_obj</span><span class="o">.</span><span class="n">set_initial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_function</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_wc&#39;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_scale</span><span class="p">,</span>
                           <span class="n">eft</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eft</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">basis</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wc_obj</span>

    <span class="k">def</span> <span class="nf">log_prior_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the prior probability for all fit and nuisance parameters</span>
<span class="sd">        given an input array&quot;&quot;&quot;</span>
        <span class="n">par_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_par_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">exclude_parameters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">par_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">))</span>
        <span class="n">prob_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">exclude_parameters</span><span class="o">=</span><span class="n">exclude_parameters</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prob_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>

    <span class="k">def</span> <span class="nf">log_prior_wilson_coeffs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the prior probability for all Wilson coefficients</span>
<span class="sd">        given an input array&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_priors</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="n">wc_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array_to_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="s1">&#39;fit_wc&#39;</span><span class="p">]</span>
        <span class="n">prob_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_priors</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">wc_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prob_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>

    <span class="k">def</span> <span class="nf">get_predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">par</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nuisance</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">wc</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a dictionary with predictions for all observables given an input</span>
<span class="sd">        array.</span>

<span class="sd">        If par is False, fit parameters are set to their central values.</span>
<span class="sd">        If nuisance is False, nuisance parameters are set to their central values.</span>
<span class="sd">        If wc is False, Wilson coefficients are set to their SM values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">par_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_par_dict</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">par</span><span class="o">=</span><span class="n">par</span><span class="p">,</span> <span class="n">nuisance</span><span class="o">=</span><span class="n">nuisance</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wc</span><span class="p">:</span>
            <span class="n">wc_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wc_obj</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wc_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">physics</span><span class="o">.</span><span class="n">eft</span><span class="o">.</span><span class="n">_wc_sm</span>
        <span class="n">all_predictions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">observable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">observable</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">obs_name</span> <span class="o">=</span> <span class="n">observable</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">_inst</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="p">[</span><span class="n">obs_name</span><span class="p">]</span>
                <span class="n">all_predictions</span><span class="p">[</span><span class="n">observable</span><span class="p">]</span> <span class="o">=</span> <span class="n">_inst</span><span class="o">.</span><span class="n">prediction_par</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="o">*</span><span class="n">observable</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_inst</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="p">[</span><span class="n">observable</span><span class="p">]</span>
                <span class="n">all_predictions</span><span class="p">[</span><span class="n">observable</span><span class="p">]</span> <span class="o">=</span> <span class="n">_inst</span><span class="o">.</span><span class="n">prediction_par</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">all_predictions</span>

    <span class="k">def</span> <span class="nf">get_predictions_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_predictions</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pred</span><span class="p">[</span><span class="n">obs</span><span class="p">]</span> <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">log_prior_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the prior probability (or frequentist likelihood) for all</span>
<span class="sd">        fit and (!) nuisance parameters given an input array&quot;&quot;&quot;</span>
        <span class="n">par_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_par_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">exclude_parameters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">par_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">))</span>
        <span class="n">prob_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">exclude_parameters</span><span class="o">=</span><span class="n">exclude_parameters</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prob_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>

    <span class="k">def</span> <span class="nf">log_prior_nuisance_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the prior probability (or frequentist likelihood) for all</span>
<span class="sd">        nuisance parameters given an input array&quot;&quot;&quot;</span>
        <span class="n">par_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_par_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">exclude_parameters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">par_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">))</span>
        <span class="n">prob_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">exclude_parameters</span><span class="o">=</span><span class="n">exclude_parameters</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prob_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>

    <span class="k">def</span> <span class="nf">log_likelihood_exp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the logarithm of the likelihood function (not including the</span>
<span class="sd">        prior)&quot;&quot;&quot;</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_predictions</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">for</span> <span class="n">measurement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_measurements</span><span class="p">:</span>
            <span class="n">m_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">Measurement</span><span class="p">[</span><span class="n">measurement</span><span class="p">]</span>
            <span class="n">m_obs</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span>
            <span class="n">exclude_observables</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">m_obs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span>
            <span class="n">prob_dict</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">exclude_parameters</span><span class="o">=</span><span class="n">exclude_observables</span><span class="p">)</span>
            <span class="n">ll</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">prob_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">ll</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#flavio.statistics.fits.Fit">Fit</a></li>
          <li>flavio.classes.NamedInstanceClass</li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.Fit.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, name, par_obj=&lt;flavio.classes.ParameterConstraints object at 0x7fbc2e148048&gt;, fit_parameters=None, nuisance_parameters=None, observables=None, fit_wc_names=None, fit_wc_function=None, fit_wc_priors=None, input_scale=160.0, exclude_measurements=None, include_measurements=None, fit_wc_eft=&#39;WET&#39;, fit_wc_basis=&#39;flavio&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialize self.  See help(type(self)) for accurate signature.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.Fit.__init__', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.Fit.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">name</span><span class="p">,</span>
             <span class="n">par_obj</span><span class="o">=</span><span class="n">flavio</span><span class="o">.</span><span class="n">default_parameters</span><span class="p">,</span>
             <span class="n">fit_parameters</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">nuisance_parameters</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">observables</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">fit_wc_names</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">fit_wc_function</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">fit_wc_priors</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">input_scale</span><span class="o">=</span><span class="mf">160.</span><span class="p">,</span>
             <span class="n">exclude_measurements</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">include_measurements</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">fit_wc_eft</span><span class="o">=</span><span class="s1">&#39;WET&#39;</span><span class="p">,</span>
             <span class="n">fit_wc_basis</span><span class="o">=</span><span class="s1">&#39;flavio&#39;</span><span class="p">,</span>
            <span class="p">):</span>
    <span class="k">if</span> <span class="n">fit_parameters</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span> <span class="o">=</span> <span class="n">fit_parameters</span>
    <span class="k">if</span> <span class="n">nuisance_parameters</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">elif</span> <span class="n">nuisance_parameters</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span> <span class="o">=</span> <span class="n">par_obj</span><span class="o">.</span><span class="n">all_parameters</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span> <span class="o">=</span> <span class="n">nuisance_parameters</span>
    <span class="k">if</span> <span class="n">observables</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;observables&#39; is empty: you must specify at least one fit observable&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fit_wc_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;The &#39;fit_wc_names&#39; argument is no longer necessary &quot;</span>
        <span class="s2">&quot;as of flavio v0.19 and might be removed in the future.&quot;</span><span class="p">,</span>
        <span class="ne">FutureWarning</span><span class="p">)</span>
    <span class="c1"># some checks to make sure the input is sane</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">:</span>
        <span class="c1"># check that nuisance parameters are constrained</span>
        <span class="k">assert</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">par_obj</span><span class="o">.</span><span class="n">_parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="s2">&quot;Parameter &quot;</span> <span class="o">+</span> <span class="n">p</span> <span class="o">+</span> <span class="s2">&quot; not found in Constraints&quot;</span>
    <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">observables</span><span class="p">:</span>
        <span class="c1"># check that observables exist</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="p">[</span><span class="n">obs</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unexpected form of observable: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obs</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Observable &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; not found!&quot;</span><span class="p">)</span>
    <span class="n">_obs_measured</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">exclude_measurements</span> <span class="ow">and</span> <span class="n">include_measurements</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The options exclude_measurements and include_measurements must not be specified simultaneously&quot;</span><span class="p">)</span>
    <span class="c1"># check that no parameter appears as fit *and* nuisance parameter</span>
    <span class="n">intersect</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">intersect</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(),</span> <span class="s2">&quot;Parameters appearing as fit_parameters and nuisance_parameters: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">intersect</span><span class="p">)</span>
    <span class="c1"># check that the Wilson coefficient function works</span>
    <span class="k">if</span> <span class="n">fit_wc_function</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="c1"># if list of WC names not empty</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">fit_wc_function</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">fit_wc_function</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">fit_wc_name</span><span class="p">:</span> <span class="mf">1e-6</span> <span class="k">for</span> <span class="n">fit_wc_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">})</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Error in calling the Wilson coefficient function&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>
    <span class="c1"># now that everything seems fine, we can call the init of the parent class</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span> <span class="o">=</span> <span class="n">par_obj</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parameters_central</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_central_all</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">exclude_measurements</span> <span class="o">=</span> <span class="n">exclude_measurements</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">include_measurements</span> <span class="o">=</span> <span class="n">include_measurements</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_function</span> <span class="o">=</span> <span class="n">fit_wc_function</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_priors</span> <span class="o">=</span> <span class="n">fit_wc_priors</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">observables</span> <span class="o">=</span> <span class="n">observables</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_scale</span> <span class="o">=</span> <span class="n">input_scale</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_warn_meas_corr</span>
    <span class="c1"># check that observables are constrained</span>
    <span class="k">for</span> <span class="n">m_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_measurements</span><span class="p">:</span>
        <span class="n">m_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">Measurement</span><span class="p">[</span><span class="n">m_name</span><span class="p">]</span>
        <span class="n">_obs_measured</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span><span class="p">)</span>
    <span class="n">missing_obs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">observables</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">_obs_measured</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">observables</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">missing_obs</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(),</span> <span class="s2">&quot;No measurement found for the observables: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">missing_obs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eft</span> <span class="o">=</span> <span class="n">fit_wc_eft</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="n">fit_wc_basis</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.Fit.array_to_dict">
    <p>def <span class="ident">array_to_dict</span>(</p><p>self, x)</p>
    </div>
    

    
  
    <div class="desc"><p>Convert a 1D numpy array of floats to a dictionary of fit parameters,
nuisance parameters, and Wilson coefficients.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.Fit.array_to_dict', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.Fit.array_to_dict" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">array_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a 1D numpy array of floats to a dictionary of fit parameters,</span>
<span class="sd">    nuisance parameters, and Wilson coefficients.&quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">n_fit_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span>
    <span class="n">n_nui_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span>
    <span class="n">n_wc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">p</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;nuisance_parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">p</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">n_fit_p</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_wc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">p</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">n_fit_p</span> <span class="o">+</span> <span class="n">n_nui_p</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span> <span class="p">}</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.Fit.dict_to_array">
    <p>def <span class="ident">dict_to_array</span>(</p><p>self, d)</p>
    </div>
    

    
  
    <div class="desc"><p>Convert a dictionary of fit parameters,
nuisance parameters, and Wilson coefficients to a 1D numpy array of
floats.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.Fit.dict_to_array', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.Fit.dict_to_array" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">dict_to_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a dictionary of fit parameters,</span>
<span class="sd">    nuisance parameters, and Wilson coefficients to a 1D numpy array of</span>
<span class="sd">    floats.&quot;&quot;&quot;</span>
    <span class="n">n_fit_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span>
    <span class="n">n_nui_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span>
    <span class="n">n_wc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_fit_p</span> <span class="o">+</span> <span class="n">n_nui_p</span> <span class="o">+</span> <span class="n">n_wc</span><span class="p">)</span>
    <span class="n">arr</span><span class="p">[:</span><span class="n">n_fit_p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_parameters&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">]</span>
    <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="p">:</span><span class="n">n_fit_p</span><span class="o">+</span><span class="n">n_nui_p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;nuisance_parameters&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">]</span>
    <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="o">+</span><span class="n">n_nui_p</span><span class="p">:]</span>   <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_wc&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">arr</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.Fit.get_par_dict">
    <p>def <span class="ident">get_par_dict</span>(</p><p>self, x, par=True, nuisance=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Get a dictionary of fit and nuisance parameters from an input array</p>
<p>If par is False, fit parameters are set to their central values.
If nuisance is False, nuisance parameters are set to their central values.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.Fit.get_par_dict', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.Fit.get_par_dict" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_par_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">par</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nuisance</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get a dictionary of fit and nuisance parameters from an input array</span>
<span class="sd">    If par is False, fit parameters are set to their central values.</span>
<span class="sd">    If nuisance is False, nuisance parameters are set to their central values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array_to_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">par_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters_central</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">par</span><span class="p">:</span>
        <span class="n">par_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_parameters&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">nuisance</span><span class="p">:</span>
        <span class="n">par_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;nuisance_parameters&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">par_dict</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.Fit.get_predictions">
    <p>def <span class="ident">get_predictions</span>(</p><p>self, x, par=True, nuisance=True, wc=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Get a dictionary with predictions for all observables given an input
array.</p>
<p>If par is False, fit parameters are set to their central values.
If nuisance is False, nuisance parameters are set to their central values.
If wc is False, Wilson coefficients are set to their SM values.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.Fit.get_predictions', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.Fit.get_predictions" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">par</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nuisance</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">wc</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get a dictionary with predictions for all observables given an input</span>
<span class="sd">    array.</span>
<span class="sd">    If par is False, fit parameters are set to their central values.</span>
<span class="sd">    If nuisance is False, nuisance parameters are set to their central values.</span>
<span class="sd">    If wc is False, Wilson coefficients are set to their SM values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">par_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_par_dict</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">par</span><span class="o">=</span><span class="n">par</span><span class="p">,</span> <span class="n">nuisance</span><span class="o">=</span><span class="n">nuisance</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wc</span><span class="p">:</span>
        <span class="n">wc_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wc_obj</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">wc_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">physics</span><span class="o">.</span><span class="n">eft</span><span class="o">.</span><span class="n">_wc_sm</span>
    <span class="n">all_predictions</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">observable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">observable</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">obs_name</span> <span class="o">=</span> <span class="n">observable</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">_inst</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="p">[</span><span class="n">obs_name</span><span class="p">]</span>
            <span class="n">all_predictions</span><span class="p">[</span><span class="n">observable</span><span class="p">]</span> <span class="o">=</span> <span class="n">_inst</span><span class="o">.</span><span class="n">prediction_par</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="o">*</span><span class="n">observable</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_inst</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="p">[</span><span class="n">observable</span><span class="p">]</span>
            <span class="n">all_predictions</span><span class="p">[</span><span class="n">observable</span><span class="p">]</span> <span class="o">=</span> <span class="n">_inst</span><span class="o">.</span><span class="n">prediction_par</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">all_predictions</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.Fit.get_predictions_array">
    <p>def <span class="ident">get_predictions_array</span>(</p><p>self, x, **kwargs)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.Fit.get_predictions_array', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.Fit.get_predictions_array" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_predictions_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_predictions</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pred</span><span class="p">[</span><span class="n">obs</span><span class="p">]</span> <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.Fit.get_wc_obj">
    <p>def <span class="ident">get_wc_obj</span>(</p><p>self, x)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.Fit.get_wc_obj', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.Fit.get_wc_obj" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_wc_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="n">wc_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">WilsonCoefficients</span><span class="p">()</span>
    <span class="c1"># if there are no WCs to be fitted, return the SM WCs</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">wc_obj</span>
    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array_to_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">wc_obj</span><span class="o">.</span><span class="n">set_initial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_function</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_wc&#39;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_scale</span><span class="p">,</span>
                       <span class="n">eft</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eft</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">basis</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wc_obj</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.Fit.log_likelihood_exp">
    <p>def <span class="ident">log_likelihood_exp</span>(</p><p>self, x)</p>
    </div>
    

    
  
    <div class="desc"><p>Return the logarithm of the likelihood function (not including the
prior)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.Fit.log_likelihood_exp', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.Fit.log_likelihood_exp" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">log_likelihood_exp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the logarithm of the likelihood function (not including the</span>
<span class="sd">    prior)&quot;&quot;&quot;</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_predictions</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">for</span> <span class="n">measurement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_measurements</span><span class="p">:</span>
        <span class="n">m_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">Measurement</span><span class="p">[</span><span class="n">measurement</span><span class="p">]</span>
        <span class="n">m_obs</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span>
        <span class="n">exclude_observables</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">m_obs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span>
        <span class="n">prob_dict</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">exclude_parameters</span><span class="o">=</span><span class="n">exclude_observables</span><span class="p">)</span>
        <span class="n">ll</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">prob_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">ll</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.Fit.log_prior_nuisance_parameters">
    <p>def <span class="ident">log_prior_nuisance_parameters</span>(</p><p>self, x)</p>
    </div>
    

    
  
    <div class="desc"><p>Return the prior probability (or frequentist likelihood) for all
nuisance parameters given an input array</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.Fit.log_prior_nuisance_parameters', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.Fit.log_prior_nuisance_parameters" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">log_prior_nuisance_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the prior probability (or frequentist likelihood) for all</span>
<span class="sd">    nuisance parameters given an input array&quot;&quot;&quot;</span>
    <span class="n">par_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_par_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">exclude_parameters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">par_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">))</span>
    <span class="n">prob_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">exclude_parameters</span><span class="o">=</span><span class="n">exclude_parameters</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prob_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.Fit.log_prior_parameters">
    <p>def <span class="ident">log_prior_parameters</span>(</p><p>self, x)</p>
    </div>
    

    
  
    <div class="desc"><p>Return the prior probability (or frequentist likelihood) for all
fit and (!) nuisance parameters given an input array</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.Fit.log_prior_parameters', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.Fit.log_prior_parameters" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">log_prior_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the prior probability (or frequentist likelihood) for all</span>
<span class="sd">    fit and (!) nuisance parameters given an input array&quot;&quot;&quot;</span>
    <span class="n">par_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_par_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">exclude_parameters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">par_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">))</span>
    <span class="n">prob_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">exclude_parameters</span><span class="o">=</span><span class="n">exclude_parameters</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prob_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.Fit.log_prior_wilson_coeffs">
    <p>def <span class="ident">log_prior_wilson_coeffs</span>(</p><p>self, x)</p>
    </div>
    

    
  
    <div class="desc"><p>Return the prior probability for all Wilson coefficients
given an input array</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.Fit.log_prior_wilson_coeffs', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.Fit.log_prior_wilson_coeffs" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">log_prior_wilson_coeffs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the prior probability for all Wilson coefficients</span>
<span class="sd">    given an input array&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_priors</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="n">wc_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array_to_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="s1">&#39;fit_wc&#39;</span><span class="p">]</span>
    <span class="n">prob_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_priors</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">wc_dict</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prob_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.Fit.set_description">
    <p>def <span class="ident">set_description</span>(</p><p>self, description)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.Fit.set_description', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.Fit.set_description" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="flavio.statistics.fits.Fit.basis" class="name">var <span class="ident">basis</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.Fit.dimension" class="name">var <span class="ident">dimension</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.Fit.eft" class="name">var <span class="ident">eft</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.Fit.exclude_measurements" class="name">var <span class="ident">exclude_measurements</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.Fit.fit_wc_function" class="name">var <span class="ident">fit_wc_function</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.Fit.fit_wc_priors" class="name">var <span class="ident">fit_wc_priors</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.Fit.get_central_fit_parameters" class="name">var <span class="ident">get_central_fit_parameters</span></p>
            

            
  
    <div class="desc"><p>Return a numpy array with the central values of all fit parameters.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.Fit.get_central_nuisance_parameters" class="name">var <span class="ident">get_central_nuisance_parameters</span></p>
            

            
  
    <div class="desc"><p>Return a numpy array with the central values of all nuisance parameters.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.Fit.get_measurements" class="name">var <span class="ident">get_measurements</span></p>
            

            
  
    <div class="desc"><p>Return a list of all the measurements currently defined that
constrain any of the fit observables.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.Fit.get_random" class="name">var <span class="ident">get_random</span></p>
            

            
  
    <div class="desc"><p>Get an array with random values for all the fit and nuisance
parameters and Wilson coefficients.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.Fit.get_random_fit_parameters" class="name">var <span class="ident">get_random_fit_parameters</span></p>
            

            
  
    <div class="desc"><p>Return a numpy array with random values for all fit parameters.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.Fit.get_random_nuisance_parameters" class="name">var <span class="ident">get_random_nuisance_parameters</span></p>
            

            
  
    <div class="desc"><p>Return a numpy array with random values for all nuisance parameters.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.Fit.get_random_start" class="name">var <span class="ident">get_random_start</span></p>
            

            
  
    <div class="desc"><p>Get an array with random values for all the fit and nuisance
parameters with Wilson coefficients set to their SM values</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.Fit.get_random_wilson_coeffs" class="name">var <span class="ident">get_random_wilson_coeffs</span></p>
            

            
  
    <div class="desc"><p>Return a numpy array with random values for all Wilson coefficients.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.Fit.get_random_wilson_coeffs_start" class="name">var <span class="ident">get_random_wilson_coeffs_start</span></p>
            

            
  
    <div class="desc"><p>Return a numpy array with random values for all Wilson coefficients
sampling the start_wc_priors distribution.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.Fit.include_measurements" class="name">var <span class="ident">include_measurements</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.Fit.input_scale" class="name">var <span class="ident">input_scale</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.Fit.observables" class="name">var <span class="ident">observables</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.Fit.par_obj" class="name">var <span class="ident">par_obj</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.Fit.parameters_central" class="name">var <span class="ident">parameters_central</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.Fit.clear_all">
    <p>def <span class="ident">clear_all</span>(</p><p>cls)</p>
    </div>
    

    
  
    <div class="desc"><p>Delete all instances.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.Fit.clear_all', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.Fit.clear_all" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">clear_all</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Delete all instances.&quot;&quot;&quot;</span>
    <span class="bp">cls</span><span class="o">.</span><span class="n">instances</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.Fit.del_instance">
    <p>def <span class="ident">del_instance</span>(</p><p>cls, name)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.Fit.del_instance', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.Fit.del_instance" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">del_instance</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="k">del</span> <span class="bp">cls</span><span class="o">.</span><span class="n">instances</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.Fit.get_instance">
    <p>def <span class="ident">get_instance</span>(</p><p>cls, name)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.Fit.get_instance', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.Fit.get_instance" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">get_instance</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">instances</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="flavio.statistics.fits.FrequentistFit" class="name">class <span class="ident">FrequentistFit</span></p>
      
  
    <div class="desc"><p>Frequentist fit class.</p>
<h2>Parameters</h2>
<ul>
<li><code>name</code>: a descriptive string name</li>
<li><code>par_obj</code>: optional; an instance of <code>ParameterConstraints</code>.
  Defaults to <code>flavio.default_parameters</code></li>
<li><code>fit_parameters</code>: a list of string names of parameters of interest.
  Existing constraints on the parameter will be ignored.</li>
<li><code>nuisance_parameters</code>: a list of string names of nuisance parameters. The existing
  constraints on the parameter will be interpreted as pseudo-measurement
  entering the likelihood.</li>
<li><code>observables</code>: a list of observable names to be included in the fit</li>
<li><code>exclude_measurements</code>: optional; a list of measurement names <em>not</em> to be included in
the fit. By default, all existing measurements are included.</li>
<li><code>include_measurements</code>: optional; a list of measurement names to be included in
the fit. By default, all existing measurements are included.</li>
<li><code>fit_wc_names</code>: optional; a list of string names of arguments of the Wilson
  coefficient function below</li>
<li><code>fit_wc_function</code>: optional; a function that
  returns a dictionary that can be fed to the <code>set_initial</code>
  method of the Wilson coefficient class. Example: fit the real and imaginary
  parts of $C_{10}$ in $b\to s\mu^+\mu^-$.
<code>def fit_wc_function(Re_C10, Im_C10):
    return {'C10_bsmmumu': Re_C10 + 1j*Im_C10}</code></li>
<li><code>input_scale</code>: input scale for the Wilson coeffficients. Defaults to 160.</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FrequentistFit', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FrequentistFit" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">FrequentistFit</span><span class="p">(</span><span class="n">Fit</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Frequentist fit class.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    - `name`: a descriptive string name</span>
<span class="sd">    - `par_obj`: optional; an instance of `ParameterConstraints`.</span>
<span class="sd">      Defaults to `flavio.default_parameters`</span>
<span class="sd">    - `fit_parameters`: a list of string names of parameters of interest.</span>
<span class="sd">      Existing constraints on the parameter will be ignored.</span>
<span class="sd">    - `nuisance_parameters`: a list of string names of nuisance parameters. The existing</span>
<span class="sd">      constraints on the parameter will be interpreted as pseudo-measurement</span>
<span class="sd">      entering the likelihood.</span>
<span class="sd">    - `observables`: a list of observable names to be included in the fit</span>
<span class="sd">    - `exclude_measurements`: optional; a list of measurement names *not* to be included in</span>
<span class="sd">    the fit. By default, all existing measurements are included.</span>
<span class="sd">    - `include_measurements`: optional; a list of measurement names to be included in</span>
<span class="sd">    the fit. By default, all existing measurements are included.</span>
<span class="sd">    - `fit_wc_names`: optional; a list of string names of arguments of the Wilson</span>
<span class="sd">      coefficient function below</span>
<span class="sd">    - `fit_wc_function`: optional; a function that</span>
<span class="sd">      returns a dictionary that can be fed to the `set_initial`</span>
<span class="sd">      method of the Wilson coefficient class. Example: fit the real and imaginary</span>
<span class="sd">      parts of $C_{10}$ in $b\to s\mu^+\mu^-$.</span>
<span class="sd">    ```</span>
<span class="sd">    def fit_wc_function(Re_C10, Im_C10):</span>
<span class="sd">        return {&#39;C10_bsmmumu&#39;: Re_C10 + 1j*Im_C10}</span>
<span class="sd">    ```</span>
<span class="sd">    - `input_scale`: input scale for the Wilson coeffficients. Defaults to 160.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the logarithm of the likelihood function (including the</span>
<span class="sd">        lihelihood of nuisance parameters!)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood_exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_prior_nuisance_parameters</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#flavio.statistics.fits.FrequentistFit">FrequentistFit</a></li>
          <li><a href="#flavio.statistics.fits.Fit">Fit</a></li>
          <li>flavio.classes.NamedInstanceClass</li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FrequentistFit.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, *args, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialize self.  See help(type(self)) for accurate signature.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FrequentistFit.__init__', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FrequentistFit.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FrequentistFit.array_to_dict">
    <p>def <span class="ident">array_to_dict</span>(</p><p>self, x)</p>
    </div>
    

    
  
    <div class="desc"><p>Convert a 1D numpy array of floats to a dictionary of fit parameters,
nuisance parameters, and Wilson coefficients.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FrequentistFit.array_to_dict', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FrequentistFit.array_to_dict" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">array_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a 1D numpy array of floats to a dictionary of fit parameters,</span>
<span class="sd">    nuisance parameters, and Wilson coefficients.&quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">n_fit_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span>
    <span class="n">n_nui_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span>
    <span class="n">n_wc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">p</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;nuisance_parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">p</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">n_fit_p</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_wc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">p</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">n_fit_p</span> <span class="o">+</span> <span class="n">n_nui_p</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span> <span class="p">}</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FrequentistFit.dict_to_array">
    <p>def <span class="ident">dict_to_array</span>(</p><p>self, d)</p>
    </div>
    

    
  
    <div class="desc"><p>Convert a dictionary of fit parameters,
nuisance parameters, and Wilson coefficients to a 1D numpy array of
floats.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FrequentistFit.dict_to_array', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FrequentistFit.dict_to_array" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">dict_to_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a dictionary of fit parameters,</span>
<span class="sd">    nuisance parameters, and Wilson coefficients to a 1D numpy array of</span>
<span class="sd">    floats.&quot;&quot;&quot;</span>
    <span class="n">n_fit_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span>
    <span class="n">n_nui_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">)</span>
    <span class="n">n_wc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">)</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_fit_p</span> <span class="o">+</span> <span class="n">n_nui_p</span> <span class="o">+</span> <span class="n">n_wc</span><span class="p">)</span>
    <span class="n">arr</span><span class="p">[:</span><span class="n">n_fit_p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_parameters&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">]</span>
    <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="p">:</span><span class="n">n_fit_p</span><span class="o">+</span><span class="n">n_nui_p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;nuisance_parameters&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">]</span>
    <span class="n">arr</span><span class="p">[</span><span class="n">n_fit_p</span><span class="o">+</span><span class="n">n_nui_p</span><span class="p">:]</span>   <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_wc&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">arr</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FrequentistFit.get_par_dict">
    <p>def <span class="ident">get_par_dict</span>(</p><p>self, x, par=True, nuisance=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Get a dictionary of fit and nuisance parameters from an input array</p>
<p>If par is False, fit parameters are set to their central values.
If nuisance is False, nuisance parameters are set to their central values.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FrequentistFit.get_par_dict', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FrequentistFit.get_par_dict" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_par_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">par</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nuisance</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get a dictionary of fit and nuisance parameters from an input array</span>
<span class="sd">    If par is False, fit parameters are set to their central values.</span>
<span class="sd">    If nuisance is False, nuisance parameters are set to their central values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array_to_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">par_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters_central</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">par</span><span class="p">:</span>
        <span class="n">par_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_parameters&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">nuisance</span><span class="p">:</span>
        <span class="n">par_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;nuisance_parameters&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">par_dict</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FrequentistFit.get_predictions">
    <p>def <span class="ident">get_predictions</span>(</p><p>self, x, par=True, nuisance=True, wc=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Get a dictionary with predictions for all observables given an input
array.</p>
<p>If par is False, fit parameters are set to their central values.
If nuisance is False, nuisance parameters are set to their central values.
If wc is False, Wilson coefficients are set to their SM values.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FrequentistFit.get_predictions', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FrequentistFit.get_predictions" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">par</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nuisance</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">wc</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get a dictionary with predictions for all observables given an input</span>
<span class="sd">    array.</span>
<span class="sd">    If par is False, fit parameters are set to their central values.</span>
<span class="sd">    If nuisance is False, nuisance parameters are set to their central values.</span>
<span class="sd">    If wc is False, Wilson coefficients are set to their SM values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">par_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_par_dict</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">par</span><span class="o">=</span><span class="n">par</span><span class="p">,</span> <span class="n">nuisance</span><span class="o">=</span><span class="n">nuisance</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wc</span><span class="p">:</span>
        <span class="n">wc_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wc_obj</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">wc_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">physics</span><span class="o">.</span><span class="n">eft</span><span class="o">.</span><span class="n">_wc_sm</span>
    <span class="n">all_predictions</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">observable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">observable</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">obs_name</span> <span class="o">=</span> <span class="n">observable</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">_inst</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="p">[</span><span class="n">obs_name</span><span class="p">]</span>
            <span class="n">all_predictions</span><span class="p">[</span><span class="n">observable</span><span class="p">]</span> <span class="o">=</span> <span class="n">_inst</span><span class="o">.</span><span class="n">prediction_par</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="o">*</span><span class="n">observable</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_inst</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="p">[</span><span class="n">observable</span><span class="p">]</span>
            <span class="n">all_predictions</span><span class="p">[</span><span class="n">observable</span><span class="p">]</span> <span class="o">=</span> <span class="n">_inst</span><span class="o">.</span><span class="n">prediction_par</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">all_predictions</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FrequentistFit.get_predictions_array">
    <p>def <span class="ident">get_predictions_array</span>(</p><p>self, x, **kwargs)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FrequentistFit.get_predictions_array', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FrequentistFit.get_predictions_array" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_predictions_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_predictions</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pred</span><span class="p">[</span><span class="n">obs</span><span class="p">]</span> <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FrequentistFit.get_wc_obj">
    <p>def <span class="ident">get_wc_obj</span>(</p><p>self, x)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FrequentistFit.get_wc_obj', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FrequentistFit.get_wc_obj" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_wc_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="n">wc_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">WilsonCoefficients</span><span class="p">()</span>
    <span class="c1"># if there are no WCs to be fitted, return the SM WCs</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_names</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">wc_obj</span>
    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array_to_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">wc_obj</span><span class="o">.</span><span class="n">set_initial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_function</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;fit_wc&#39;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_scale</span><span class="p">,</span>
                       <span class="n">eft</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eft</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">basis</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wc_obj</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FrequentistFit.log_likelihood">
    <p>def <span class="ident">log_likelihood</span>(</p><p>self, x)</p>
    </div>
    

    
  
    <div class="desc"><p>Return the logarithm of the likelihood function (including the
lihelihood of nuisance parameters!)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FrequentistFit.log_likelihood', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FrequentistFit.log_likelihood" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the logarithm of the likelihood function (including the</span>
<span class="sd">    lihelihood of nuisance parameters!)&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood_exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_prior_nuisance_parameters</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FrequentistFit.log_likelihood_exp">
    <p>def <span class="ident">log_likelihood_exp</span>(</p><p>self, x)</p>
    </div>
    

    
  
    <div class="desc"><p>Return the logarithm of the likelihood function (not including the
prior)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FrequentistFit.log_likelihood_exp', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FrequentistFit.log_likelihood_exp" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">log_likelihood_exp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the logarithm of the likelihood function (not including the</span>
<span class="sd">    prior)&quot;&quot;&quot;</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_predictions</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">for</span> <span class="n">measurement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_measurements</span><span class="p">:</span>
        <span class="n">m_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">Measurement</span><span class="p">[</span><span class="n">measurement</span><span class="p">]</span>
        <span class="n">m_obs</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span>
        <span class="n">exclude_observables</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">m_obs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span>
        <span class="n">prob_dict</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">exclude_parameters</span><span class="o">=</span><span class="n">exclude_observables</span><span class="p">)</span>
        <span class="n">ll</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">prob_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">ll</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FrequentistFit.log_prior_nuisance_parameters">
    <p>def <span class="ident">log_prior_nuisance_parameters</span>(</p><p>self, x)</p>
    </div>
    

    
  
    <div class="desc"><p>Return the prior probability (or frequentist likelihood) for all
nuisance parameters given an input array</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FrequentistFit.log_prior_nuisance_parameters', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FrequentistFit.log_prior_nuisance_parameters" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">log_prior_nuisance_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the prior probability (or frequentist likelihood) for all</span>
<span class="sd">    nuisance parameters given an input array&quot;&quot;&quot;</span>
    <span class="n">par_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_par_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">exclude_parameters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">par_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">))</span>
    <span class="n">prob_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">exclude_parameters</span><span class="o">=</span><span class="n">exclude_parameters</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prob_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FrequentistFit.log_prior_parameters">
    <p>def <span class="ident">log_prior_parameters</span>(</p><p>self, x)</p>
    </div>
    

    
  
    <div class="desc"><p>Return the prior probability (or frequentist likelihood) for all
fit and (!) nuisance parameters given an input array</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FrequentistFit.log_prior_parameters', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FrequentistFit.log_prior_parameters" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">log_prior_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the prior probability (or frequentist likelihood) for all</span>
<span class="sd">    fit and (!) nuisance parameters given an input array&quot;&quot;&quot;</span>
    <span class="n">par_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_par_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">exclude_parameters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">par_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">))</span>
    <span class="n">prob_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">exclude_parameters</span><span class="o">=</span><span class="n">exclude_parameters</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prob_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FrequentistFit.log_prior_wilson_coeffs">
    <p>def <span class="ident">log_prior_wilson_coeffs</span>(</p><p>self, x)</p>
    </div>
    

    
  
    <div class="desc"><p>Return the prior probability for all Wilson coefficients
given an input array</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FrequentistFit.log_prior_wilson_coeffs', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FrequentistFit.log_prior_wilson_coeffs" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">log_prior_wilson_coeffs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the prior probability for all Wilson coefficients</span>
<span class="sd">    given an input array&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_priors</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="n">wc_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array_to_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="s1">&#39;fit_wc&#39;</span><span class="p">]</span>
    <span class="n">prob_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wc_priors</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">wc_dict</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prob_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FrequentistFit.set_description">
    <p>def <span class="ident">set_description</span>(</p><p>self, description)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FrequentistFit.set_description', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FrequentistFit.set_description" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="flavio.statistics.fits.FrequentistFit.get_central_fit_parameters" class="name">var <span class="ident">get_central_fit_parameters</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#flavio.statistics.fits.Fit">Fit</a></code>.<code><a href="#flavio.statistics.fits.Fit.get_central_fit_parameters">get_central_fit_parameters</a></code>
    </p>

            
  
    <div class="desc inherited"><p>Return a numpy array with the central values of all fit parameters.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.FrequentistFit.get_central_nuisance_parameters" class="name">var <span class="ident">get_central_nuisance_parameters</span></p>
            

            
  
    <div class="desc"><p>Return a numpy array with the central values of all nuisance parameters.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.FrequentistFit.get_measurements" class="name">var <span class="ident">get_measurements</span></p>
            

            
  
    <div class="desc"><p>Return a list of all the measurements currently defined that
constrain any of the fit observables.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.FrequentistFit.get_random" class="name">var <span class="ident">get_random</span></p>
            

            
  
    <div class="desc"><p>Get an array with random values for all the fit and nuisance
parameters and Wilson coefficients.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.FrequentistFit.get_random_fit_parameters" class="name">var <span class="ident">get_random_fit_parameters</span></p>
            

            
  
    <div class="desc"><p>Return a numpy array with random values for all fit parameters.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.FrequentistFit.get_random_nuisance_parameters" class="name">var <span class="ident">get_random_nuisance_parameters</span></p>
            

            
  
    <div class="desc"><p>Return a numpy array with random values for all nuisance parameters.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.FrequentistFit.get_random_start" class="name">var <span class="ident">get_random_start</span></p>
            

            
  
    <div class="desc"><p>Get an array with random values for all the fit and nuisance
parameters with Wilson coefficients set to their SM values</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.FrequentistFit.get_random_wilson_coeffs" class="name">var <span class="ident">get_random_wilson_coeffs</span></p>
            

            
  
    <div class="desc"><p>Return a numpy array with random values for all Wilson coefficients.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.fits.FrequentistFit.get_random_wilson_coeffs_start" class="name">var <span class="ident">get_random_wilson_coeffs_start</span></p>
            

            
  
    <div class="desc"><p>Return a numpy array with random values for all Wilson coefficients
sampling the start_wc_priors distribution.</p></div>
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FrequentistFit.clear_all">
    <p>def <span class="ident">clear_all</span>(</p><p>cls)</p>
    </div>
    

    
  
    <div class="desc"><p>Delete all instances.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FrequentistFit.clear_all', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FrequentistFit.clear_all" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">clear_all</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Delete all instances.&quot;&quot;&quot;</span>
    <span class="bp">cls</span><span class="o">.</span><span class="n">instances</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FrequentistFit.del_instance">
    <p>def <span class="ident">del_instance</span>(</p><p>cls, name)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FrequentistFit.del_instance', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FrequentistFit.del_instance" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">del_instance</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="k">del</span> <span class="bp">cls</span><span class="o">.</span><span class="n">instances</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.fits.FrequentistFit.get_instance">
    <p>def <span class="ident">get_instance</span>(</p><p>cls, name)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.fits.FrequentistFit.get_instance', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.fits.FrequentistFit.get_instance" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">get_instance</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">instances</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>

  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.2</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>

    <script>
      renderMathInElement(document.body, options={delimiters:[
  {left: "$$", right: "$$", display: true},
  {left: "\\[", right: "\\]", display: true},
  {left: "\\(", right: "\\)", display: false},
  {left: "$", right: "$", display: false}
]});
    </script>
    <script type="text/javascript">
    $("script[type='math/tex; mode=display']").replaceWith(
      function(){
        var tex = $(this).text();
        return "<span class=\"katex-display\">" +
               katex.renderToString("\\displaystyle "+tex) +
               "</span>";
    });
    </script>

</body>
</html>
